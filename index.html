<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor Pro</title>
    
    <!-- TAILWIND CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: { 
                extend: { 
                    colors: { slate: { 850: '#172033', 950: '#020617' } },
                    fontFamily: { sans: ['Segoe UI', 'Roboto', 'sans-serif'] }
                } 
            }
        }
    </script>

    <!-- BIBLIOTECAS -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

    <!-- ESTILOS -->
    <style>
        body { font-family: 'Segoe UI', sans-serif; -webkit-user-select: none; user-select: none; overflow: hidden; background-color: #020617; color: white; }
        input, textarea, select { user-select: text; cursor: text; }
        .fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }
        .blur-content { filter: blur(10px); pointer-events: none; transition: filter 0.5s; opacity: 0.3; }
        #sidebar { transition: margin-left 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .sidebar-closed { margin-left: -18rem; } 
        @media (max-width: 1280px) { .sidebar-closed { margin-left: 0; transform: translateX(-100%); } .sidebar-open { transform: translateX(0); } }
        .health-bar-fill { transition: width 1s, background-color 0.5s; }
    </style>
</head>
<body class="bg-slate-950 text-slate-100 h-screen w-screen overflow-hidden flex">

    <!-- TELA DE LOGIN -->
    <div id="login-overlay" class="fixed inset-0 z-[100] bg-slate-950 flex items-center justify-center p-4 transition-opacity duration-500 overflow-hidden">
        <!-- Canvas para Fundo Animado -->
        <canvas id="login-bg-canvas" class="absolute inset-0 w-full h-full pointer-events-none"></canvas>
        <div class="absolute inset-0 bg-gradient-to-b from-transparent to-slate-950/90 pointer-events-none"></div>

        <div class="relative w-full max-w-sm bg-white/5 dark:bg-slate-900/40 backdrop-blur-2xl rounded-3xl shadow-2xl border border-white/10 p-10 text-center animate-in zoom-in-95 duration-500 ring-1 ring-white/10 z-10">
            <div class="mb-8 flex justify-center">
                <div class="relative bg-slate-950 p-5 rounded-2xl border border-slate-800 shadow-xl">
                    <i class="ph-fill ph-brain text-4xl text-blue-500"></i>
                </div>
            </div>
            <h2 class="text-3xl font-bold text-white mb-2">Gestor Pro</h2>
            <p class="text-xs font-medium text-slate-400 uppercase tracking-widest mb-8">Sistema Autónomo</p>

            <form onsubmit="handleLogin(event)" class="space-y-5 text-left">
                <input type="password" id="login-pass" placeholder="Senha Mestre" class="w-full py-4 pl-4 bg-slate-950/50 border border-slate-700/50 rounded-2xl text-white placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50 font-medium backdrop-blur-sm" required>
                <button type="submit" class="w-full py-4 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 text-white rounded-2xl font-bold text-lg shadow-lg transition-all active:scale-[0.98]">Aceder</button>
            </form>
            <p class="mt-8 text-[10px] text-slate-500 font-medium tracking-wide uppercase opacity-60">Dados salvos localmente</p>
        </div>
    </div>

    <!-- APLICAÇÃO -->
    <div id="app-content" class="flex flex-row h-full w-full blur-content transition-all duration-500 overflow-hidden absolute inset-0 opacity-0 pointer-events-none">
        
        <!-- SIDEBAR -->
        <aside id="sidebar" class="absolute xl:relative z-50 w-72 h-full bg-slate-900 border-r border-slate-800 flex flex-col shadow-2xl xl:shadow-none flex-shrink-0 transform transition-transform duration-300 xl:translate-x-0 -translate-x-full">
            <div class="p-6 border-b border-slate-800 flex items-center gap-3 shrink-0">
                <div class="w-10 h-10 rounded-xl bg-blue-600 text-white flex items-center justify-center shadow-lg"><i class="ph-bold ph-trend-up text-xl"></i></div>
                <div class="overflow-hidden"><h1 class="text-lg font-bold truncate text-white">Gestor Pro</h1><p class="text-[10px] text-slate-400 font-medium mt-1 uppercase truncate">Licenciado</p></div>
                <button onclick="toggleSidebar()" class="xl:hidden ml-auto text-slate-400 hover:text-white"><i class="ph-bold ph-x text-xl"></i></button>
            </div>

            <nav class="flex-1 overflow-y-auto p-4 space-y-1.5 custom-scrollbar">
                <button onclick="mudarAba('crm')" id="btn-crm" class="tab-btn w-full active px-4 py-3 rounded-xl text-sm font-semibold transition-all flex items-center gap-3 bg-blue-600 text-white shadow-md text-left"><i class="ph-bold ph-users text-lg"></i> Prospecção</button>
                <button onclick="mudarAba('scripts')" id="btn-scripts" class="tab-btn w-full px-4 py-3 rounded-xl text-sm font-medium transition-all text-slate-400 hover:bg-slate-800 hover:text-white flex items-center gap-3 text-left"><i class="ph-bold ph-chat-text text-lg"></i> Scripts</button>
                <button onclick="mudarAba('financeiro')" id="btn-financeiro" class="tab-btn w-full px-4 py-3 rounded-xl text-sm font-medium transition-all text-slate-400 hover:bg-slate-800 hover:text-white flex items-center gap-3 text-left"><i class="ph-bold ph-briefcase text-lg"></i> Empresa</button>
                <button onclick="mudarAba('pessoal')" id="btn-pessoal" class="tab-btn w-full px-4 py-3 rounded-xl text-sm font-medium transition-all text-slate-400 hover:bg-slate-800 hover:text-white flex items-center gap-3 text-left"><i class="ph-bold ph-house text-lg"></i> Pessoal</button>
                <button onclick="mudarAba('notas')" id="btn-notas" class="tab-btn w-full px-4 py-3 rounded-xl text-sm font-medium transition-all text-slate-400 hover:bg-slate-800 hover:text-white flex items-center gap-3 text-left"><i class="ph-bold ph-receipt text-lg"></i> Notas</button>
                <button onclick="mudarAba('contratos')" id="btn-contratos" class="tab-btn w-full px-4 py-3 rounded-xl text-sm font-medium transition-all text-slate-400 hover:bg-slate-800 hover:text-white flex items-center gap-3 text-left"><i class="ph-bold ph-file-text text-lg"></i> Contratos</button>
                <button onclick="mudarAba('sem_retorno')" id="btn-sem_retorno" class="tab-btn w-full px-4 py-3 rounded-xl text-sm font-medium transition-all text-slate-400 hover:bg-slate-800 hover:text-white flex items-center gap-3 text-left"><i class="ph-bold ph-clock text-lg"></i> Sem Retorno</button>
                <div class="border-t border-slate-800 my-4 mx-3"></div>
                <button onclick="logout()" class="w-full px-4 py-3 rounded-xl text-sm font-medium transition-all text-rose-400 hover:bg-rose-900/20 flex items-center gap-3 text-left"><i class="ph-bold ph-sign-out text-lg"></i> Sair</button>
            </nav>
            
            <div class="p-4 border-t border-slate-800 bg-slate-900/50 shrink-0 flex justify-between gap-2">
                <button onclick="mudarAba('perfil')" class="flex-1 p-2.5 rounded-lg bg-slate-800 text-slate-400 hover:text-white transition-colors"><i class="ph-bold ph-user-gear text-lg"></i></button>
                <button onclick="togglePrivacy()" id="btn-eye-desktop" class="flex-1 p-2.5 rounded-lg bg-slate-800 text-slate-400 hover:text-white transition-colors"><i class="ph-bold ph-eye text-lg"></i></button>
            </div>
        </aside>

        <div id="sidebar-overlay" onclick="toggleSidebar()" class="fixed inset-0 bg-black/50 z-40 hidden xl:hidden backdrop-blur-sm transition-opacity"></div>

        <!-- MAIN -->
        <div class="flex-1 flex flex-col h-full min-w-0 bg-slate-950 relative overflow-hidden">
            <header class="xl:hidden bg-slate-900 border-b border-slate-800 shrink-0 z-30 px-4 py-3 flex items-center justify-between shadow-sm">
                <div class="flex items-center gap-3"><button onclick="toggleSidebar()" class="p-2 -ml-2 text-slate-300 hover:bg-slate-800 rounded-lg"><i class="ph-bold ph-list text-2xl"></i></button><span class="font-bold text-lg text-white">Gestor Pro</span></div>
                <button onclick="togglePrivacy()" id="btn-eye-mobile" class="p-2 text-slate-500 dark:text-slate-400"><i class="ph-bold ph-eye text-xl"></i></button>
            </header>

            <main class="flex-1 overflow-y-auto scroll-smooth relative p-6" id="main-scroll-area">
                <div id="toast" class="hidden fixed bottom-6 right-6 bg-slate-800 text-white px-6 py-3 rounded-lg shadow-xl z-[300] font-medium transition-all duration-300 translate-y-10 opacity-0 border border-slate-700"></div>

                <!-- CRM -->
                <div id="view-crm" class="view-section fade-in">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                        <div class="bg-slate-900 p-5 rounded-2xl border border-slate-800 shadow-sm relative overflow-hidden group"><p class="text-xs text-slate-400 font-bold uppercase">Em Negociação</p><h3 class="text-2xl font-bold text-blue-400 mt-1" id="crm-potencial">R$ 0,00</h3></div>
                        <div class="bg-slate-900 p-5 rounded-2xl border-l-4 border-emerald-600 shadow-sm border-slate-800"><p class="text-xs text-slate-400 font-bold uppercase">Ativos (Receita)</p><h3 class="text-2xl font-bold text-emerald-400 mt-1" id="crm-ativos">R$ 0,00</h3></div>
                        <div class="bg-slate-900 p-5 rounded-2xl border-l-4 border-amber-600 shadow-sm border-slate-800"><p class="text-xs text-slate-400 font-bold uppercase">Sem Retorno</p><h3 class="text-2xl font-bold text-amber-400 mt-1" id="crm-sem-retorno">R$ 0,00</h3></div>
                        <div class="bg-slate-900 p-5 rounded-2xl border-l-4 border-slate-600 shadow-sm border-slate-800"><p class="text-xs text-slate-400 font-bold uppercase">Inativos</p><h3 class="text-2xl font-bold text-slate-300 mt-1" id="crm-inativos">R$ 0,00</h3></div>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-1 bg-slate-900 p-5 rounded-2xl shadow-sm border border-slate-800 h-fit">
                            <h3 class="font-bold text-lg mb-4 text-white">Novo Lead</h3>
                            <form onsubmit="adicionarLead(event)" class="space-y-3">
                                <input type="text" id="lead-nome" placeholder="Nome" required class="w-full p-3 bg-slate-950 border border-slate-700 rounded-lg text-white">
                                <input type="text" id="lead-empresa" placeholder="Empresa" class="w-full p-3 bg-slate-950 border border-slate-700 rounded-lg text-white">
                                <div class="grid grid-cols-2 gap-2">
                                    <input type="text" id="lead-doc" placeholder="CPF/CNPJ" class="w-full p-3 bg-slate-950 border border-slate-700 rounded-lg text-white text-sm">
                                    <input type="text" id="lead-social" placeholder="Social Link" class="w-full p-3 bg-slate-950 border border-slate-700 rounded-lg text-white text-sm">
                                </div>
                                <input type="number" id="lead-valor" placeholder="Valor" step="0.01" class="w-full p-3 bg-slate-950 border border-slate-700 rounded-lg text-white">
                                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-500 text-white py-3 rounded-xl font-bold">Cadastrar</button>
                            </form>
                        </div>
                        <div class="lg:col-span-2 space-y-4" id="lista-leads"></div>
                    </div>
                </div>

                <!-- FINANCEIRO PJ -->
                <div id="view-financeiro" class="view-section hidden fade-in">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div class="bg-slate-900 p-4 rounded-xl border-l-4 border-emerald-500"><p class="text-sm text-emerald-400 font-bold">Receita</p><h3 class="text-2xl font-bold text-emerald-300" id="pj-receita">R$ 0,00</h3></div>
                        <div class="bg-slate-900 p-4 rounded-xl border-l-4 border-rose-500"><p class="text-sm font-bold text-rose-400">Despesas</p><h3 class="text-2xl font-bold text-rose-300" id="pj-despesa">R$ 0,00</h3></div>
                        <div class="bg-slate-900 p-4 rounded-xl border-l-4 border-blue-500"><p class="text-sm font-bold text-slate-400">Caixa</p><h3 class="text-2xl font-bold text-white" id="pj-saldo">R$ 0,00</h3></div>
                    </div>
                    
                    <!-- MEDIDOR SAÚDE -->
                    <div class="bg-slate-900 p-5 rounded-xl border border-slate-800 shadow-sm mb-6">
                        <div class="flex justify-between items-center mb-4"><h3 class="font-bold text-white flex gap-2"><i class="ph-fill ph-heartbeat text-rose-500 text-xl"></i> Saúde Financeira</h3><div class="flex gap-2 bg-slate-800 p-1.5 rounded-lg"><span class="text-xs font-bold text-slate-400 uppercase pt-1">Retenção:</span><input type="number" id="input-reserva" value="20" class="w-12 bg-slate-900 border border-slate-600 rounded text-center text-sm font-bold text-white" onchange="renderizar()"><span class="text-sm font-bold text-slate-300">%</span></div></div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-center">
                            <div><div class="flex justify-between mb-1"><span class="text-xs text-slate-400 uppercase">Status</span><span id="label-saude-status" class="text-sm font-bold text-emerald-400">--</span></div><div class="w-full h-4 bg-slate-800 rounded-full overflow-hidden"><div id="bar-saude-fill" class="h-full bg-emerald-500 w-0 transition-all"></div></div></div>
                            <div class="bg-indigo-900/10 p-4 rounded-xl border border-indigo-800/30 flex justify-between items-center"><div><span class="block text-xs font-bold text-slate-400 uppercase">Seu Salário</span><span class="text-[10px] text-slate-500">Pró-Labore Livre</span></div><span id="val-meu-salario" class="text-2xl font-bold text-emerald-400">R$ 0,00</span></div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-2 bg-slate-900 p-4 rounded-xl border border-slate-800 h-96"><canvas id="grafico-pj" height="250"></canvas><div class="h-48 overflow-y-auto mt-4"><table class="w-full text-left text-sm"><tbody id="lista-transacoes-pj" class="divide-y divide-slate-800"></tbody></table></div></div>
                        <div class="bg-slate-900 p-5 rounded-xl border border-slate-800 h-fit"><h3 class="font-bold text-lg mb-4 text-white">Lançar</h3><form onsubmit="adicionarTransacao(event, 'pj')" class="space-y-3"><div class="flex gap-2"><label class="flex-1 cursor-pointer bg-slate-950 p-2 rounded text-center border border-slate-800"><input type="radio" name="pj-tipo" value="entrada" checked class="hidden">Entrada</label><label class="flex-1 cursor-pointer bg-slate-950 p-2 rounded text-center border border-slate-800"><input type="radio" name="pj-tipo" value="saida" class="hidden">Saída</label></div><input type="text" id="pj-desc" placeholder="Descrição" required class="w-full p-2.5 bg-slate-950 border border-slate-800 rounded-lg text-white"><input type="number" id="pj-valor" placeholder="Valor" step="0.01" required class="w-full p-2.5 bg-slate-950 border border-slate-800 rounded-lg text-white"><div class="grid grid-cols-2 gap-2"><select id="pj-modalidade" class="p-2.5 bg-slate-950 border border-slate-700 rounded-lg text-white text-sm" onchange="toggleModalidade('pj')"><option value="unico">Único</option><option value="recorrente">Recorrente</option><option value="parcelado">Parcelado</option></select><input type="date" id="pj-data" required class="p-2.5 bg-slate-950 border border-slate-700 rounded-lg text-white text-sm"></div><div id="pj-parcelas-container" class="hidden"><input type="number" id="pj-parcelas" placeholder="Qtd Meses/Parcelas" class="w-full p-2.5 bg-slate-950 border border-slate-700 rounded-lg text-white mt-2"></div><button type="submit" class="w-full bg-slate-700 hover:bg-slate-600 text-white py-2.5 rounded-lg font-bold">Salvar</button></form></div>
                    </div>
                </div>

                <!-- PESSOAL -->
                <div id="view-pessoal" class="view-section hidden fade-in">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6"><div class="bg-slate-900 p-4 rounded-xl border-l-4 border-blue-500"><p class="text-sm text-blue-400 font-bold">Entradas</p><h3 class="text-2xl font-bold text-blue-300" id="pf-receita">R$ 0,00</h3></div><div class="bg-slate-900 p-4 rounded-xl border-l-4 border-orange-500"><p class="text-sm text-orange-400 font-bold">Saídas</p><h3 class="text-2xl font-bold text-orange-300" id="pf-despesa">R$ 0,00</h3></div><div class="bg-slate-900 p-4 rounded-xl border-l-4 border-slate-500"><p class="text-sm text-slate-400 font-bold">Saldo</p><h3 class="text-2xl font-bold text-white" id="pf-saldo">R$ 0,00</h3></div></div>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6"><div class="lg:col-span-2 bg-slate-900 p-4 rounded-xl border border-slate-800 h-96"><canvas id="grafico-pf" height="250"></canvas><div class="h-48 overflow-y-auto mt-4"><table class="w-full text-left text-sm"><tbody id="lista-transacoes-pf" class="divide-y divide-slate-800"></tbody></table></div></div><div class="bg-slate-900 p-5 rounded-xl border border-slate-800 h-fit"><h3 class="font-bold text-lg mb-4 text-white">Lançar Pessoal</h3><form onsubmit="adicionarTransacao(event, 'pf')" class="space-y-3"><div class="flex gap-2"><label class="flex-1 cursor-pointer bg-slate-950 p-2 rounded text-center border border-slate-800"><input type="radio" name="pf-tipo" value="entrada" checked class="hidden">Ganho</label><label class="flex-1 cursor-pointer bg-slate-950 p-2 rounded text-center border border-slate-800"><input type="radio" name="pf-tipo" value="saida" class="hidden">Gasto</label></div><input type="text" id="pf-desc" placeholder="Descrição" required class="w-full p-2.5 bg-slate-950 border border-slate-700 rounded-lg text-white"><input type="number" id="pf-valor" placeholder="Valor" step="0.01" required class="w-full p-2.5 bg-slate-950 border border-slate-700 rounded-lg text-white"><div class="grid grid-cols-2 gap-2"><select id="pf-modalidade" class="p-2.5 bg-slate-950 border border-slate-700 rounded-lg text-white text-sm" onchange="toggleModalidade('pf')"><option value="unico">Único</option><option value="recorrente">Recorrente</option><option value="parcelado">Parcelado</option></select><input type="date" id="pf-data" required class="w-full p-2.5 bg-slate-950 border border-slate-700 rounded-lg text-white text-sm"><div id="pf-parcelas-container" class="hidden"><input type="number" id="pf-parcelas" placeholder="Qtd Meses/Parcelas" class="w-full p-2.5 bg-slate-950 border border-slate-700 rounded-lg text-white mt-2"></div><button type="submit" class="w-full bg-blue-600 hover:bg-blue-500 text-white py-2.5 rounded-lg font-bold">Salvar</button></form></div></div>
                </div>

                <!-- SCRIPTS -->
                <div id="view-scripts" class="view-section hidden fade-in"><h3 class="font-bold text-lg text-slate-400 mb-4">Scripts de Vendas</h3><div class="grid grid-cols-1 lg:grid-cols-3 gap-6"><div class="lg:col-span-1 bg-slate-900 p-5 rounded-xl border border-slate-800"><form onsubmit="adicionarScript(event)" class="space-y-4"><input type="text" id="script-titulo" placeholder="Título" class="w-full p-2.5 bg-slate-950 border-slate-800 rounded text-white"><textarea id="script-texto" rows="5" placeholder="Texto..." class="w-full p-2.5 bg-slate-950 border-slate-800 rounded text-white"></textarea><button type="button" onclick="gerarScriptIA()" class="text-xs text-purple-400 mb-2 block">✨ Gerar com IA</button><button type="submit" class="w-full bg-indigo-600 text-white py-2 rounded">Salvar</button></form></div><div id="lista-scripts" class="lg:col-span-2 space-y-4"></div></div></div>
                
                <!-- NOTAS -->
                <div id="view-notas" class="view-section hidden fade-in"><h3 class="font-bold text-lg text-slate-400 mb-4">Notas Fiscais</h3><div class="grid grid-cols-1 lg:grid-cols-3 gap-6"><div class="lg:col-span-1 bg-slate-900 p-5 rounded-xl border border-slate-800"><form onsubmit="adicionarNota(event)" class="space-y-3"><input id="nota-numero" placeholder="Nº" class="w-full p-2.5 bg-slate-950 border-slate-800 rounded text-white"><input id="nota-cliente" placeholder="Cliente" class="w-full p-2.5 bg-slate-950 border-slate-800 rounded text-white"><input id="nota-valor" placeholder="Valor" class="w-full p-2.5 bg-slate-950 border-slate-800 rounded text-white"><input type="date" id="nota-data" class="w-full p-2.5 bg-slate-950 border-slate-800 rounded text-white"><input id="nota-link" placeholder="Link do Drive" class="w-full p-2.5 bg-slate-950 border-slate-800 rounded text-white"><button class="w-full bg-indigo-600 py-2 rounded text-white font-bold">Salvar</button></form></div><div id="lista-notas" class="lg:col-span-2 space-y-3"></div></div></div>

                <!-- OUTROS -->
                <div id="view-sem_retorno" class="view-section hidden fade-in"><h3 class="text-white mb-4">Sem Retorno</h3><div id="lista-sem-retorno" class="space-y-2"></div></div>
                <div id="view-ativos" class="view-section hidden fade-in"><h3 class="text-white mb-4">Ativos</h3><div id="lista-ativos-grid" class="grid grid-cols-2 gap-4"></div></div>
                <div id="view-contratos" class="view-section hidden fade-in"><h3 class="text-white mb-4">Contratos</h3><div id="lista-contratos" class="grid grid-cols-2 gap-4"></div></div>
                <div id="view-inativos" class="view-section hidden fade-in"><h3 class="text-white mb-4">Inativos</h3><div id="lista-inativos" class="space-y-2"></div></div>
                <div id="view-perfil" class="view-section hidden fade-in"><div class="bg-slate-900 p-6 rounded max-w-xl mx-auto"><h3 class="text-white mb-4">Perfil</h3><form onsubmit="salvarPerfil(event)" class="space-y-4"><input id="prof-company" placeholder="Empresa" class="w-full p-3 bg-slate-950 rounded text-white"><input id="prof-name" placeholder="Nome" class="w-full p-3 bg-slate-950 rounded text-white"><input id="prof-email" placeholder="Email" class="w-full p-3 bg-slate-950 rounded text-white"><button class="bg-blue-600 px-6 py-2 rounded text-white font-bold">Salvar</button></form></div></div>
            </main>
        </div>
    </div>

    <!-- MODALS -->
    <div id="modal-config" class="hidden fixed inset-0 z-50 bg-slate-950/90 flex items-center justify-center p-4 backdrop-blur-sm"><div class="bg-slate-900 p-6 rounded-xl border border-slate-700 w-full max-w-md"><h3 class="text-white mb-4">Configurar IA</h3><input type="password" id="input-api-key" placeholder="API Key" class="w-full p-2 bg-slate-950 border border-slate-700 rounded text-white mb-4"><div class="flex justify-end gap-2"><button onclick="document.getElementById('modal-config').classList.add('hidden')" class="text-slate-400">Cancelar</button><button onclick="salvarConfig()" class="bg-blue-600 px-4 py-2 rounded text-white">Salvar</button></div></div></div>
    
    <!-- MODAL DE EDIÇÃO -->
    <div id="custom-input-box-container"></div>

    <!-- LOGIC -->
    <script>
        // --- 1. ESTADO GLOBAL ---
        const DB = {
            leads: JSON.parse(localStorage.getItem('gpro_leads')) || [],
            pj: JSON.parse(localStorage.getItem('gpro_pj')) || [],
            pf: JSON.parse(localStorage.getItem('gpro_pf')) || [],
            scripts: JSON.parse(localStorage.getItem('gpro_scripts')) || [],
            notas: JSON.parse(localStorage.getItem('gpro_notas')) || [],
            profile: JSON.parse(localStorage.getItem('gpro_profile')) || {},
            settings: JSON.parse(localStorage.getItem('gpro_settings')) || { reinvestRate: 20 }
        };
        let showValues = true;
        let chartInstancePJ=null, chartInstancePF=null;

        // --- 2. AUTH ---
        const checkAuth = () => {
            const hash = localStorage.getItem('gpro_auth');
            const overlay = document.getElementById('login-overlay');
            const app = document.getElementById('app-content');
            if(hash) {
                overlay.classList.add('opacity-0', 'pointer-events-none');
                app.classList.remove('opacity-0', 'pointer-events-none', 'blur-content');
                initBackgroundAnimation();
                renderizar();
            } else {
                overlay.classList.remove('opacity-0', 'pointer-events-none');
                app.classList.add('opacity-0', 'pointer-events-none', 'blur-content');
                initBackgroundAnimation();
            }
        };

        const handleLogin = (e) => {
            e.preventDefault();
            const pass = document.getElementById('login-pass').value;
            if(pass.length < 4) return alert("Senha muito curta");
            const hash = CryptoJS.SHA256(pass).toString();
            // Simulação de check (primeiro login define a senha)
            const stored = localStorage.getItem('gpro_auth');
            if(!stored) { localStorage.setItem('gpro_auth', hash); checkAuth(); }
            else if(stored === hash) { checkAuth(); }
            else { alert("Senha incorreta"); }
        };

        const logout = () => { localStorage.removeItem('gpro_auth'); location.reload(); };

        // --- 3. LÓGICA DE DADOS ---
        const saveData = () => {
            localStorage.setItem('gpro_leads', JSON.stringify(DB.leads));
            localStorage.setItem('gpro_pj', JSON.stringify(DB.pj));
            localStorage.setItem('gpro_pf', JSON.stringify(DB.pf));
            localStorage.setItem('gpro_scripts', JSON.stringify(DB.scripts));
            localStorage.setItem('gpro_notas', JSON.stringify(DB.notas));
            localStorage.setItem('gpro_profile', JSON.stringify(DB.profile));
            localStorage.setItem('gpro_settings', JSON.stringify(DB.settings));
        };

        const adicionarLead = (e) => {
            e.preventDefault();
            const nome = document.getElementById('lead-nome').value;
            const valor = parseFloat(document.getElementById('lead-valor').value)||0;
            DB.leads.push({ id: Date.now(), nome, valor, status: 'negociacao', empresa: document.getElementById('lead-empresa').value, doc: document.getElementById('lead-doc').value, social: document.getElementById('lead-social').value });
            saveData(); renderizar(); e.target.reset();
        };

        const alterarStatusLead = (id, status) => {
            const l = DB.leads.find(x => x.id == id);
            if(l) {
                const oldStatus = l.status;
                l.status = status;
                if(status === 'ganho' && oldStatus !== 'ganho') {
                    DB.pj.unshift({ id: Date.now(), op: 'entrada', desc: `Fechamento: ${l.nome}`, valor: l.valor, data: new Date().toISOString().split('T')[0], modalidade: 'unico', leadId: id });
                } else if (oldStatus === 'ganho' && status !== 'ganho') {
                    DB.pj = DB.pj.filter(t => t.leadId != id);
                }
                saveData(); renderizar();
            }
        };

        const adicionarTransacao = (e, tipo) => {
            e.preventDefault();
            const list = tipo === 'pj' ? DB.pj : DB.pf;
            const op = document.querySelector(`input[name="${tipo}-tipo"]:checked`).value;
            const desc = document.getElementById(`${tipo}-desc`).value;
            const val = parseFloat(document.getElementById(`${tipo}-valor`).value);
            const mod = document.getElementById(`${tipo}-modalidade`).value;
            const dt = document.getElementById(`${tipo}-data`).value;
            const qtd = parseInt(document.getElementById(`${tipo}-parcelas`)?.value)||1;
            
            let loop = mod === 'unico' ? 1 : (mod === 'parcelado' ? qtd : 12);
            let dateObj = new Date(dt);
            
            for(let i=0; i<loop; i++) {
                let d = new Date(dateObj); d.setMonth(d.getMonth()+i);
                let dsc = desc; if(mod==='parcelado') dsc += ` (${i+1}/${loop})`;
                list.unshift({ id: Date.now()+i, op, desc: dsc, valor: val, data: d.toISOString().split('T')[0], modalidade: mod });
            }
            saveData(); renderizar(); e.target.reset();
        };

        const adicionarScript = (e) => {
            e.preventDefault();
            DB.scripts.push({ id: Date.now(), titulo: document.getElementById('script-titulo').value, texto: document.getElementById('script-texto').value });
            saveData(); renderizar(); e.target.reset();
        };

        const adicionarNota = (e) => {
            e.preventDefault();
            DB.notas.push({ id: Date.now(), numero: document.getElementById('nota-numero').value, cliente: document.getElementById('nota-cliente').value, valor: parseFloat(document.getElementById('nota-valor').value)||0, data: document.getElementById('nota-data').value, link: document.getElementById('nota-link').value });
            saveData(); renderizar(); e.target.reset();
        };
        
        const excluirItem = (tipo, id) => {
            if(!confirm("Apagar?")) return;
            if(tipo === 'leads') { DB.leads = DB.leads.filter(x => x.id != id); DB.pj = DB.pj.filter(t => t.leadId != id); }
            if(tipo === 'pj') DB.pj = DB.pj.filter(x => x.id != id);
            if(tipo === 'pf') DB.pf = DB.pf.filter(x => x.id != id);
            if(tipo === 'scripts') DB.scripts = DB.scripts.filter(x => x.id != id);
            if(tipo === 'notas') DB.notas = DB.notas.filter(x => x.id != id);
            saveData(); renderizar();
        };

        const salvarPerfil = (e) => {
            e.preventDefault();
            DB.profile.company = document.getElementById('prof-company').value;
            DB.profile.name = document.getElementById('prof-name').value;
            DB.profile.email = document.getElementById('prof-email').value;
            saveData(); alert("Salvo!");
        };

        // Edição
        const editarValorLead = (id) => {
            const l = DB.leads.find(x => x.id == id);
            if(!l) return;
            const existing = document.getElementById('custom-input-box'); if(existing) existing.remove();
            const box = document.createElement('div');
            box.id = 'custom-input-box';
            box.className = 'fixed inset-0 z-[300] bg-black/80 flex items-center justify-center p-4 backdrop-blur-sm fade-in';
            box.innerHTML = `<div class="bg-slate-900 p-6 rounded-2xl border border-slate-700 w-full max-w-sm"><h3 class="text-white mb-4">Editar</h3><input id="ed-nome" value="${l.nome}" class="w-full mb-3 p-3 bg-slate-950 border border-slate-800 rounded text-white"><input id="ed-valor" value="${l.valor}" type="number" class="w-full mb-4 p-3 bg-slate-950 border border-slate-800 rounded text-white"><div class="flex gap-2"><button onclick="document.getElementById('custom-input-box').remove()" class="flex-1 py-2 bg-slate-800 text-slate-400 rounded">Cancelar</button><button onclick="confirmarEdicaoValor('${id}')" class="flex-1 py-2 bg-blue-600 text-white rounded">Salvar</button></div></div>`;
            document.body.appendChild(box);
        }
        
        // Esta função precisa ser global para ser chamada pelo HTML gerado acima
        window.confirmarEdicaoValor = (id) => {
            const l = DB.leads.find(x => x.id == id);
            if(l) {
                l.nome = document.getElementById('ed-nome').value;
                l.valor = parseFloat(document.getElementById('ed-valor').value);
                const t = DB.pj.find(x => x.leadId == id);
                if(t) { t.valor = l.valor; t.desc = `Fechamento: ${l.nome}`; }
                saveData(); renderizar();
            }
            document.getElementById('custom-input-box').remove();
        }

        // --- 4. RENDERIZAÇÃO ---
        const formatMoney = (v) => showValues ? new Intl.NumberFormat('pt-BR',{style:'currency',currency:'BRL'}).format(v) : 'R$ ---';
        
        const renderizar = () => {
            // CRM
            const l = document.getElementById('lista-leads'), ls = document.getElementById('lista-sem-retorno'), la = document.getElementById('lista-ativos-grid'), lc = document.getElementById('lista-contratos'), li = document.getElementById('lista-inativos');
            [l,ls,la,lc,li].forEach(el => el.innerHTML = '');
            let pot=0, ati=0;
            
            DB.leads.forEach(x => {
                if(x.status === 'negociacao') pot += x.valor;
                if(x.status === 'ganho') ati += x.valor;
                const card = `<div class="bg-slate-900 p-4 rounded border border-slate-800 mb-2 flex justify-between"><div><div class="font-bold text-white">${x.nome}</div><div class="text-sm text-slate-400">${x.empresa} - ${formatMoney(x.valor)}</div></div><div class="flex gap-2"><button onclick="alterarStatusLead('${x.id}','ganho')" class="text-emerald-500"><i class="ph-bold ph-check"></i></button><button onclick="alterarStatusLead('${x.id}','sem_retorno')" class="text-amber-500"><i class="ph-bold ph-clock"></i></button><button onclick="editarValorLead('${x.id}')" class="text-blue-500"><i class="ph-bold ph-pencil-simple"></i></button><button onclick="excluirItem('leads','${x.id}')" class="text-slate-500"><i class="ph-bold ph-trash"></i></button></div></div>`;
                
                if(x.status === 'negociacao') l.innerHTML += card;
                if(x.status === 'sem_retorno') ls.innerHTML += card;
                if(x.status === 'ganho') {
                    la.innerHTML += `<div class="bg-slate-900 p-4 rounded border border-emerald-900"><div class="text-white font-bold">${x.nome}</div><div class="text-emerald-400">${formatMoney(x.valor)}</div><button onclick="alterarStatusLead('${x.id}','inativo')" class="text-xs bg-slate-800 mt-2 px-2 rounded">Desativar</button></div>`;
                    lc.innerHTML += `<div class="bg-slate-900 p-4 rounded border border-slate-800"><div>${x.nome}</div><div class="text-xs text-slate-500">Contrato Ativo</div></div>`;
                }
                if(x.status === 'inativo') li.innerHTML += `<div class="bg-slate-900 p-4 rounded opacity-50 flex justify-between"><div>${x.nome}</div><button onclick="excluirItem('leads','${x.id}')"><i class="ph-bold ph-trash"></i></button></div>`;
            });
            document.getElementById('crm-potencial').innerText = formatMoney(pot);
            document.getElementById('crm-ativos').innerText = formatMoney(ati);

            // FINANCEIRO
            renderFinTable('pj', DB.pj); renderFinTable('pf', DB.pf);
            
            // SAUDE
            const ent = DB.pj.filter(x=>x.op==='entrada').reduce((a,b)=>a+b.valor,0);
            const sai = DB.pj.filter(x=>x.op==='saida').reduce((a,b)=>a+b.valor,0);
            const luc = ent - sai;
            const perc = parseInt(document.getElementById('input-reserva').value)||20;
            DB.settings.reinvestRate = perc;
            const bar = document.getElementById('bar-saude-fill');
            const st = document.getElementById('label-saude-status');
            
            if(luc <= 0) {
                st.innerText = "Prejuízo"; st.className = "text-rose-500 font-bold";
                bar.className = "h-full bg-rose-500 w-full";
                document.getElementById('val-meu-salario').innerText = "R$ 0,00";
            } else {
                st.innerText = "Positivo"; st.className = "text-emerald-400 font-bold";
                bar.className = "h-full bg-emerald-500";
                bar.style.width = "100%";
                document.getElementById('val-meu-salario').innerText = formatMoney(luc * ((100-perc)/100));
            }

            // SCRIPTS & NOTAS
            document.getElementById('lista-scripts').innerHTML = DB.scripts.map(s => `<div class="bg-slate-900 p-4 rounded border border-slate-800 mb-2"><h4 class="font-bold text-white">${s.titulo}</h4><p class="text-slate-400 text-sm whitespace-pre-wrap">${s.texto}</p><button onclick="excluirItem('scripts','${s.id}')" class="text-rose-500 text-xs mt-2">Excluir</button></div>`).join('');
            document.getElementById('lista-notas').innerHTML = DB.notas.map(n => `<div class="bg-slate-900 p-4 rounded border border-slate-800 mb-2 flex justify-between"><div><div class="font-bold text-white">#${n.numero}</div><div class="text-xs text-slate-400">${n.cliente} - ${formatMoney(n.valor)}</div></div><button onclick="excluirItem('notas','${n.id}')" class="text-rose-500"><i class="ph-bold ph-trash"></i></button></div>`).join('');
            
            // PERFIL
            if(DB.profile.company) document.getElementById('prof-company').value = DB.profile.company;
            if(DB.profile.name) document.getElementById('prof-name').value = DB.profile.name;
            if(DB.profile.email) document.getElementById('prof-email').value = DB.profile.email;
        };

        const renderFinTable = (tipo, dados) => {
            const ent = dados.filter(x=>x.op==='entrada').reduce((a,b)=>a+b.valor,0);
            const sai = dados.filter(x=>x.op==='saida').reduce((a,b)=>a+b.valor,0);
            document.getElementById(`${tipo}-receita`).innerText = formatMoney(ent);
            document.getElementById(`${tipo}-despesa`).innerText = formatMoney(sai);
            document.getElementById(`${tipo}-saldo`).innerText = formatMoney(ent-sai);
            
            const tb = document.getElementById(`lista-transacoes-${tipo}`); tb.innerHTML = '';
            dados.sort((a,b)=>new Date(b.data)-new Date(a.data)).forEach(x => {
                tb.innerHTML += `<tr class="border-b border-slate-800"><td class="p-3 text-slate-300">${x.desc}<br><span class="text-xs text-slate-500">${x.data}</span></td><td class="p-3 text-right ${x.op==='entrada'?'text-emerald-400':'text-rose-400'}">${formatMoney(x.valor)}</td><td class="p-3 text-right"><button onclick="excluirItem('${tipo}','${x.id}')"><i class="ph-bold ph-trash"></i></button></td></tr>`;
            });
            
            const ctx = document.getElementById(`grafico-${tipo}`)?.getContext('2d');
            if(ctx) {
                if(tipo==='pj'&&chartInstancePJ) chartInstancePJ.destroy();
                if(tipo==='pf'&&chartInstancePF) chartInstancePF.destroy();
                const c = new Chart(ctx, { type: 'bar', data: { labels: ['Ent','Sai'], datasets: [{ data: [ent,sai], backgroundColor: [tipo==='pj'?'#10b981':'#3b82f6', '#f43f5e'] }] }, options: { scales: { y: { beginAtZero: true } } } });
                if(tipo==='pj') chartInstancePJ = c; else chartInstancePF = c;
            }
        };

        // UI UTILS
        const mudarAba = (a) => { document.querySelectorAll('.view-section').forEach(e => e.classList.add('hidden')); document.getElementById(`view-${a}`).classList.remove('hidden'); };
        const toggleSidebar = () => document.getElementById('sidebar').classList.toggle('sidebar-closed');
        const togglePrivacy = () => { showValues = !showValues; renderizar(); };
        const toggleModalidade = (t) => { if(document.getElementById(`${t}-modalidade`).value==='unico') document.getElementById(`${t}-parcelas-container`)?.classList.add('hidden'); else document.getElementById(`${t}-parcelas-container`)?.classList.remove('hidden'); };
        const initBackgroundAnimation = () => {
            const cvs = document.getElementById('login-bg-canvas'); if(!cvs) return; const ctx = cvs.getContext('2d');
            let w, h, p = []; const resize = () => { w = cvs.width = window.innerWidth; h = cvs.height = window.innerHeight; };
            window.addEventListener('resize', resize); resize();
            for(let i=0;i<60;i++)p.push({x:Math.random()*w,y:Math.random()*h,vx:(Math.random()-.5),vy:(Math.random()-.5)});
            function anim() { ctx.clearRect(0,0,w,h); ctx.fillStyle='rgba(100,150,255,0.4)'; p.forEach(pt=>{pt.x+=pt.vx;pt.y+=pt.vy;if(pt.x<0||pt.x>w)pt.vx*=-1;if(pt.y<0||pt.y>h)pt.vy*=-1;ctx.beginPath();ctx.arc(pt.x,pt.y,2,0,Math.PI*2);ctx.fill()}); requestAnimationFrame(anim); }
            anim();
        };

        // Funções Globais
        window.mudarAba = mudarAba;
        window.toggleSidebar = toggleSidebar;
        window.togglePrivacy = togglePrivacy;
        window.handleLogin = handleLogin;
        window.logout = logout;
        window.adicionarLead = adicionarLead;
        window.alterarStatusLead = alterarStatusLead;
        window.excluirItem = excluirItem;
        window.adicionarTransacao = adicionarTransacao;
        window.toggleModalidade = toggleModalidade;
        window.adicionarScript = adicionarScript;
        window.adicionarNota = adicionarNota;
        window.salvarPerfil = salvarPerfil;
        window.editarValorLead = editarValorLead;
        window.bloquearTela = () => { localStorage.removeItem('gpro_auth_temp'); location.reload(); }; // Simples refresh para bloquear
        window.abrirConfig = () => alert("Configurações em breve");
        window.gerarScriptIA = () => alert("API IA não configurada (Modo Offline)");

        // START
        checkAuth();
    </script>
</body>
</html>
