<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor Pro</title>
    
    <!-- 1. TAILWIND CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: { 
                extend: { 
                    colors: { slate: { 850: '#172033', 950: '#020617' } },
                    fontFamily: { sans: ['Segoe UI', 'Roboto', 'sans-serif'] }
                } 
            }
        }
    </script>

    <!-- 2. BIBLIOTECAS -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- 3. ESTILOS -->
    <style>
        body { font-family: 'Segoe UI', sans-serif; -webkit-user-select: none; user-select: none; overflow: hidden; background-color: #020617; color: white; }
        input, textarea, select { user-select: text; cursor: text; }
        .fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }
        .blur-content { filter: blur(10px); pointer-events: none; transition: filter 0.5s; opacity: 0.3; }
        #sidebar { transition: margin-left 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .sidebar-closed { margin-left: -18rem; } 
        @media (max-width: 1280px) { .sidebar-closed { margin-left: 0; transform: translateX(-100%); } .sidebar-open { transform: translateX(0); } }
        .health-bar-fill { transition: width 1s, background-color 0.5s; }
        .animate-blob { animation: float-blob 10s infinite alternate; }
        @keyframes float-blob {
            0% { transform: translate(0,0) scale(1); }
            33% { transform: translate(30px, -50px) scale(1.1); }
            66% { transform: translate(-20px, 20px) scale(0.9); }
            100% { transform: translate(0,0) scale(1); }
        }
    </style>
</head>
<body class="bg-slate-950 text-slate-100 h-screen w-screen overflow-hidden flex">

    <!-- LOGIN -->
    <div id="login-overlay" class="fixed inset-0 z-[100] bg-slate-950 flex items-center justify-center p-4 transition-opacity duration-500">
        <canvas id="login-bg-canvas" class="absolute inset-0 w-full h-full pointer-events-none z-0"></canvas>
        <div class="absolute inset-0 bg-gradient-to-b from-transparent to-slate-950/90 pointer-events-none z-0"></div>
        <div class="absolute inset-0 overflow-hidden pointer-events-none z-0">
            <div class="absolute top-[-10%] left-[-10%] w-96 h-96 bg-purple-600 rounded-full mix-blend-screen filter blur-[100px] opacity-40 animate-blob"></div>
            <div class="absolute top-[-10%] right-[-10%] w-96 h-96 bg-blue-600 rounded-full mix-blend-screen filter blur-[100px] opacity-40 animate-blob animation-delay-2000"></div>
        </div>
        <div class="relative w-full max-w-sm bg-white/5 dark:bg-slate-900/40 backdrop-blur-2xl rounded-3xl shadow-2xl border border-white/10 p-10 text-center animate-in zoom-in-95 duration-500 ring-1 ring-white/10 z-10">
            <div class="mb-8 flex justify-center"><div class="relative bg-slate-950 p-5 rounded-2xl border border-slate-800 shadow-xl"><i class="ph-fill ph-brain text-4xl text-blue-500"></i></div></div>
            <h2 class="text-3xl font-bold text-white mb-2">Gestor Pro</h2>
            <p class="text-xs font-medium text-slate-400 uppercase tracking-widest mb-8">Acesso Cloud & Seguro</p>
            <form id="login-form" class="space-y-5 text-left">
                <input type="email" id="login-email" placeholder="E-mail" class="w-full py-4 px-4 bg-slate-950/50 border border-slate-700/50 rounded-2xl text-white placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50 font-medium backdrop-blur-sm" required>
                <input type="password" id="login-pass" placeholder="Senha" class="w-full py-4 px-4 bg-slate-950/50 border border-slate-700/50 rounded-2xl text-white placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50 font-medium backdrop-blur-sm" required>
                <button type="submit" id="login-btn" class="w-full py-4 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 text-white rounded-2xl font-bold text-lg shadow-lg transition-all active:scale-[0.98]">Entrar</button>
            </form>
            <p id="login-msg" class="mt-6 text-xs text-rose-400 hidden text-center bg-rose-500/10 p-2 rounded border border-rose-500/20"></p>
        </div>
    </div>

    <!-- APP -->
    <div id="app-content" class="flex flex-row h-full w-full blur-content transition-all duration-500 overflow-hidden absolute inset-0 opacity-0 pointer-events-none">
        <aside id="sidebar" class="absolute xl:relative z-50 w-72 h-full bg-slate-900 border-r border-slate-800 flex flex-col shadow-2xl xl:shadow-none flex-shrink-0 transform transition-transform duration-300 xl:translate-x-0 -translate-x-full">
            <div class="p-6 border-b border-slate-800 flex items-center gap-3 shrink-0">
                <div class="w-10 h-10 rounded-xl bg-blue-600 text-white flex items-center justify-center shadow-lg"><i class="ph-bold ph-trend-up text-xl"></i></div>
                <div class="overflow-hidden"><h1 class="text-lg font-bold truncate text-white">Gestor Pro</h1><p id="user-email-display" class="text-[10px] text-slate-400 font-medium mt-1 uppercase truncate">...</p></div>
                <button onclick="toggleSidebar()" class="xl:hidden ml-auto text-slate-400 hover:text-white"><i class="ph-bold ph-x text-xl"></i></button>
            </div>
            <nav class="flex-1 overflow-y-auto p-4 space-y-1.5 custom-scrollbar">
                <button onclick="mudarAba('crm')" id="btn-crm" class="tab-btn w-full active px-4 py-3 rounded-xl text-sm font-semibold transition-all flex items-center gap-3 bg-blue-600 text-white shadow-md text-left"><i class="ph-bold ph-users text-lg"></i> Prospecção</button>
                <button onclick="mudarAba('scripts')" id="btn-scripts" class="tab-btn w-full px-4 py-3 rounded-xl text-sm font-medium transition-all text-slate-400 hover:bg-slate-800 hover:text-white flex items-center gap-3 text-left"><i class="ph-bold ph-chat-text text-lg"></i> Scripts</button>
                <button onclick="mudarAba('sem_retorno')" id="btn-sem_retorno" class="tab-btn w-full px-4 py-3 rounded-xl text-sm font-medium transition-all text-slate-400 hover:bg-slate-800 hover:text-white flex items-center gap-3 text-left"><i class="ph-bold ph-clock text-lg"></i> Sem Retorno</button>
                <button onclick="mudarAba('ativos')" id="btn-ativos" class="tab-btn w-full px-4 py-3 rounded-xl text-sm font-medium transition-all text-slate-400 hover:bg-slate-800 hover:text-white flex items-center gap-3 text-left"><i class="ph-bold ph-check-circle text-lg"></i> Ativos</button>
                <button onclick="mudarAba('contratos')" id="btn-contratos" class="tab-btn w-full px-4 py-3 rounded-xl text-sm font-medium transition-all text-slate-400 hover:bg-slate-800 hover:text-white flex items-center gap-3 text-left"><i class="ph-bold ph-file-text text-lg"></i> Contratos</button>
                <button onclick="mudarAba('notas')" id="btn-notas" class="tab-btn w-full px-4 py-3 rounded-xl text-sm font-medium transition-all text-slate-400 hover:bg-slate-800 hover:text-white flex items-center gap-3 text-left"><i class="ph-bold ph-receipt text-lg"></i> Notas</button>
                <button onclick="mudarAba('inativos')" id="btn-inativos" class="tab-btn w-full px-4 py-3 rounded-xl text-sm font-medium transition-all text-slate-400 hover:bg-slate-800 hover:text-white flex items-center gap-3 text-left"><i class="ph-bold ph-user-minus text-lg"></i> Inativos</button>
                <div class="border-t border-slate-800 my-4 mx-3"></div>
                <button onclick="mudarAba('financeiro')" id="btn-financeiro" class="tab-btn w-full px-4 py-3 rounded-xl text-sm font-medium transition-all text-slate-400 hover:bg-slate-800 hover:text-white flex items-center gap-3 text-left"><i class="ph-bold ph-briefcase text-lg"></i> Empresa</button>
                <button onclick="mudarAba('pessoal')" id="btn-pessoal" class="tab-btn w-full px-4 py-3 rounded-xl text-sm font-medium transition-all text-slate-400 hover:bg-slate-800 hover:text-white flex items-center gap-3 text-left"><i class="ph-bold ph-house text-lg"></i> Pessoal</button>
                <div class="border-t border-slate-800 my-4 mx-3"></div>
                <button onclick="logout()" class="w-full px-4 py-3 rounded-xl text-sm font-medium transition-all text-rose-400 hover:bg-rose-900/20 flex items-center gap-3 text-left"><i class="ph-bold ph-sign-out text-lg"></i> Sair</button>
            </nav>
            <div class="p-4 border-t border-slate-800 bg-slate-900/50 shrink-0 flex justify-between gap-2">
                <button onclick="mudarAba('perfil')" class="flex-1 p-2.5 rounded-lg bg-slate-800 text-slate-400 hover:text-white transition-colors"><i class="ph-bold ph-user-gear text-lg"></i></button>
                <button onclick="abrirConfig()" class="flex-1 p-2.5 rounded-lg bg-slate-800 text-slate-400 hover:text-white transition-colors"><i class="ph-bold ph-gear text-lg"></i></button>
                <button onclick="togglePrivacy()" id="btn-eye-desktop" class="flex-1 p-2.5 rounded-lg bg-slate-800 text-slate-400 hover:text-white transition-colors"><i class="ph-bold ph-eye text-lg"></i></button>
            </div>
        </aside>
        <div id="sidebar-overlay" onclick="toggleSidebar()" class="fixed inset-0 bg-black/50 z-40 hidden xl:hidden backdrop-blur-sm transition-opacity"></div>

        <!-- MAIN -->
        <div class="flex-1 flex flex-col h-full min-w-0 bg-slate-950 relative overflow-hidden">
            <header class="xl:hidden bg-slate-900 border-b border-slate-800 shrink-0 z-30 px-4 py-3 flex items-center justify-between shadow-sm">
                <div class="flex items-center gap-3"><button onclick="toggleSidebar()" class="p-2 -ml-2 text-slate-300 hover:bg-slate-800 rounded-lg"><i class="ph-bold ph-list text-2xl"></i></button><span class="font-bold text-lg text-white">Gestor Pro</span></div>
                <button onclick="togglePrivacy()" id="btn-eye-mobile" class="p-2 text-slate-500 dark:text-slate-400"><i class="ph-bold ph-eye text-xl"></i></button>
            </header>

            <main class="flex-1 overflow-y-auto scroll-smooth relative p-6" id="main-scroll-area">
                <div id="toast" class="hidden fixed bottom-6 right-6 bg-slate-800 text-white px-6 py-3 rounded-lg shadow-xl z-[300] font-medium transition-all duration-300 translate-y-10 opacity-0 border border-slate-700"></div>

                <!-- CRM -->
                <div id="view-crm" class="view-section fade-in">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                        <div class="bg-slate-900 p-5 rounded-2xl border border-slate-800 shadow-sm relative overflow-hidden group"><p class="text-xs text-slate-400 font-bold uppercase">Em Negociação</p><h3 class="text-2xl font-bold text-blue-400 mt-1" id="crm-potencial">R$ 0,00</h3></div>
                        <div class="bg-slate-900 p-5 rounded-2xl border-l-4 border-emerald-600 shadow-sm border-slate-800"><p class="text-xs text-slate-400 font-bold uppercase">Ativos</p><h3 class="text-2xl font-bold text-emerald-400 mt-1" id="crm-ativos">R$ 0,00</h3></div>
                        <div class="bg-slate-900 p-5 rounded-2xl border-l-4 border-amber-600 shadow-sm border-slate-800"><p class="text-xs text-slate-400 font-bold uppercase">Sem Retorno</p><h3 class="text-2xl font-bold text-amber-400 mt-1" id="crm-sem-retorno">R$ 0,00</h3></div>
                        <div class="bg-slate-900 p-5 rounded-2xl border-l-4 border-slate-600 shadow-sm border-slate-800"><p class="text-xs text-slate-400 font-bold uppercase">Inativos</p><h3 class="text-2xl font-bold text-slate-300 mt-1" id="crm-inativos">R$ 0,00</h3></div>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-1 bg-slate-900 p-5 rounded-2xl shadow-sm border border-slate-800 h-fit">
                            <h3 class="font-bold text-lg mb-4 text-white">Novo Lead</h3>
                            <form onsubmit="adicionarLead(event)" class="space-y-3">
                                <input type="text" id="lead-nome" placeholder="Nome" required class="w-full p-3 bg-slate-950 border border-slate-700 rounded-lg text-white">
                                <input type="text" id="lead-empresa" placeholder="Empresa" class="w-full p-3 bg-slate-950 border border-slate-700 rounded-lg text-white">
                                <div class="grid grid-cols-2 gap-2">
                                    <input type="text" id="lead-doc" placeholder="CPF/CNPJ" class="w-full p-3 bg-slate-950 border border-slate-700 rounded-lg text-white text-sm">
                                    <input type="text" id="lead-social" placeholder="Social Link" class="w-full p-3 bg-slate-950 border border-slate-700 rounded-lg text-white text-sm">
                                </div>
                                <input type="number" id="lead-valor" placeholder="Valor" step="0.01" class="w-full p-3 bg-slate-950 border border-slate-700 rounded-lg text-white">
                                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-500 text-white py-3 rounded-xl font-bold">Cadastrar</button>
                            </form>
                        </div>
                        <div class="lg:col-span-2 space-y-4" id="lista-leads"></div>
                    </div>
                </div>

                <!-- FINANCEIRO PJ -->
                <div id="view-financeiro" class="view-section hidden fade-in">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div class="bg-slate-900 p-4 rounded-xl border-l-4 border-emerald-500"><p class="text-sm text-emerald-400 font-bold">Receita</p><h3 class="text-2xl font-bold text-emerald-300" id="pj-receita">R$ 0,00</h3></div>
                        <div class="bg-slate-900 p-4 rounded-xl border-l-4 border-rose-500"><p class="text-sm font-bold text-rose-400">Despesas</p><h3 class="text-2xl font-bold text-rose-300" id="pj-despesa">R$ 0,00</h3></div>
                        <div class="bg-slate-900 p-4 rounded-xl border-l-4 border-blue-500"><p class="text-sm font-bold text-slate-400">Caixa</p><h3 class="text-2xl font-bold text-white" id="pj-saldo">R$ 0,00</h3></div>
                    </div>
                    
                    <!-- MEDIDOR SAÚDE -->
                    <div class="bg-slate-900 p-5 rounded-xl border border-slate-800 shadow-sm mb-6">
                        <div class="flex justify-between items-center mb-4"><h3 class="font-bold text-white flex gap-2"><i class="ph-fill ph-heartbeat text-rose-500 text-xl"></i> Saúde Financeira</h3><div class="flex gap-2 bg-slate-800 p-1.5 rounded-lg"><span class="text-xs font-bold text-slate-400 uppercase pt-1">Retenção:</span><input type="number" id="input-reserva" value="20" class="w-12 bg-slate-900 border border-slate-600 rounded text-center text-sm font-bold text-white" onchange="calcularSaudeFinanceira()"><span class="text-sm font-bold text-slate-300">%</span></div></div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-center">
                            <div><div class="flex justify-between mb-1"><span class="text-xs text-slate-400 uppercase">Status</span><span id="label-saude-status" class="text-sm font-bold text-emerald-400">--</span></div><div class="w-full h-4 bg-slate-800 rounded-full overflow-hidden"><div id="bar-saude-fill" class="h-full bg-emerald-500 w-0 transition-all"></div></div></div>
                            <div class="bg-indigo-900/10 p-4 rounded-xl border border-indigo-800/30 flex justify-between items-center"><div><span class="block text-xs font-bold text-slate-400 uppercase">Seu Salário</span><span class="text-[10px] text-slate-500">Pró-Labore Livre</span></div><span id="val-meu-salario" class="text-2xl font-bold text-emerald-400">R$ 0,00</span></div>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-2 bg-slate-900 p-4 rounded-xl border border-slate-800 h-96"><canvas id="grafico-pj" height="250"></canvas><div class="h-48 overflow-y-auto mt-4"><table class="w-full text-left text-sm"><tbody id="lista-transacoes-pj" class="divide-y divide-slate-800"></tbody></table></div></div>
                        <div class="bg-slate-900 p-5 rounded-xl border border-slate-800 h-fit"><h3 class="font-bold text-lg mb-4 text-white">Lançar</h3><form onsubmit="adicionarTransacao(event, 'pj')" class="space-y-3"><div class="flex gap-2"><label class="flex-1 cursor-pointer bg-slate-950 p-2 rounded text-center border border-slate-800"><input type="radio" name="pj-tipo" value="entrada" checked class="hidden">Entrada</label><label class="flex-1 cursor-pointer bg-slate-950 p-2 rounded text-center border border-slate-800"><input type="radio" name="pj-tipo" value="saida" class="hidden">Saída</label></div><input type="text" id="pj-desc" placeholder="Descrição" required class="w-full p-2.5 bg-slate-950 border border-slate-800 rounded-lg text-white"><input type="number" id="pj-valor" placeholder="Valor" step="0.01" required class="w-full p-2.5 bg-slate-950 border border-slate-800 rounded-lg text-white"><div class="grid grid-cols-2 gap-2"><select id="pj-modalidade" class="p-2.5 bg-slate-950 border border-slate-700 rounded-lg text-white text-sm" onchange="toggleModalidade('pj')"><option value="unico">Único</option><option value="recorrente">Recorrente</option><option value="parcelado">Parcelado</option></select><input type="date" id="pj-data" required class="p-2.5 bg-slate-950 border border-slate-700 rounded-lg text-white text-sm"></div><div id="pj-parcelas-container" class="hidden"><input type="number" id="pj-parcelas" placeholder="Qtd Meses/Parcelas" class="w-full p-2.5 bg-slate-950 border border-slate-700 rounded-lg text-white mt-2"></div><button type="submit" class="w-full bg-slate-700 hover:bg-slate-600 text-white py-2.5 rounded-lg font-bold">Salvar</button></form></div>
                    </div>
                </div>

                <!-- PESSOAL -->
                <div id="view-pessoal" class="view-section hidden fade-in">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6"><div class="bg-slate-900 p-4 rounded-xl border-l-4 border-blue-500"><p class="text-sm text-blue-400 font-bold">Entradas</p><h3 class="text-2xl font-bold text-blue-300" id="pf-receita">R$ 0,00</h3></div><div class="bg-slate-900 p-4 rounded-xl border-l-4 border-orange-500"><p class="text-sm text-orange-400 font-bold">Saídas</p><h3 class="text-2xl font-bold text-orange-300" id="pf-despesa">R$ 0,00</h3></div><div class="bg-slate-900 p-4 rounded-xl border-l-4 border-slate-500"><p class="text-sm text-slate-400 font-bold">Saldo</p><h3 class="text-2xl font-bold text-white" id="pf-saldo">R$ 0,00</h3></div></div>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6"><div class="lg:col-span-2 bg-slate-900 p-4 rounded-xl border border-slate-800 h-96"><canvas id="grafico-pf" height="250"></canvas><div class="h-48 overflow-y-auto mt-4"><table class="w-full text-left text-sm"><tbody id="lista-transacoes-pf" class="divide-y divide-slate-800"></tbody></table></div></div><div class="bg-slate-900 p-5 rounded-xl border border-slate-800 h-fit"><h3 class="font-bold text-lg mb-4 text-white">Lançar Pessoal</h3><form onsubmit="adicionarTransacao(event, 'pf')" class="space-y-3"><div class="flex gap-2"><label class="flex-1 cursor-pointer bg-slate-950 p-2 rounded text-center border border-slate-800"><input type="radio" name="pf-tipo" value="entrada" checked class="hidden">Ganho</label><label class="flex-1 cursor-pointer bg-slate-950 p-2 rounded text-center border border-slate-800"><input type="radio" name="pf-tipo" value="saida" class="hidden">Gasto</label></div><input type="text" id="pf-desc" placeholder="Descrição" required class="w-full p-2.5 bg-slate-950 border border-slate-700 rounded-lg text-white"><input type="number" id="pf-valor" placeholder="Valor" step="0.01" required class="w-full p-2.5 bg-slate-950 border border-slate-700 rounded-lg text-white"><div class="grid grid-cols-2 gap-2"><select id="pf-modalidade" class="p-2.5 bg-slate-950 border border-slate-700 rounded-lg text-white text-sm" onchange="toggleModalidade('pf')"><option value="unico">Único</option><option value="recorrente">Recorrente</option><option value="parcelado">Parcelado</option></select><input type="date" id="pf-data" required class="w-full p-2.5 bg-slate-950 border border-slate-700 rounded-lg text-white text-sm"><div id="pf-parcelas-container" class="hidden"><input type="number" id="pf-parcelas" placeholder="Qtd Meses/Parcelas" class="w-full p-2.5 bg-slate-950 border border-slate-700 rounded-lg text-white mt-2"></div><button type="submit" class="w-full bg-blue-600 hover:bg-blue-500 text-white py-2.5 rounded-lg font-bold">Salvar</button></form></div></div>
                </div>

                <!-- SCRIPTS -->
                <div id="view-scripts" class="view-section hidden fade-in"><h3 class="font-bold text-lg text-slate-400 mb-4">Scripts de Vendas</h3><div class="grid grid-cols-1 lg:grid-cols-3 gap-6"><div class="lg:col-span-1 bg-slate-900 p-5 rounded-xl border border-slate-800"><form onsubmit="adicionarScript(event)" class="space-y-4"><input type="text" id="script-titulo" placeholder="Título" class="w-full p-2.5 bg-slate-950 border-slate-800 rounded text-white"><textarea id="script-texto" rows="5" placeholder="Texto..." class="w-full p-2.5 bg-slate-950 border-slate-800 rounded text-white"></textarea><button type="button" onclick="gerarScriptIA()" class="text-xs text-purple-400 mb-2 block">✨ Gerar com IA</button><button type="submit" class="w-full bg-indigo-600 text-white py-2 rounded">Salvar</button></form></div><div id="lista-scripts" class="lg:col-span-2 space-y-4"></div></div></div>
                
                <!-- NOTAS -->
                <div id="view-notas" class="view-section hidden fade-in"><h3 class="font-bold text-lg text-slate-400 mb-4">Notas Fiscais</h3><div class="grid grid-cols-1 lg:grid-cols-3 gap-6"><div class="lg:col-span-1 bg-slate-900 p-5 rounded-xl border border-slate-800"><form onsubmit="adicionarNota(event)" class="space-y-3"><input id="nota-numero" placeholder="Nº" class="w-full p-2.5 bg-slate-950 border-slate-800 rounded text-white"><input id="nota-cliente" placeholder="Cliente" class="w-full p-2.5 bg-slate-950 border-slate-800 rounded text-white"><input id="nota-valor" placeholder="Valor" class="w-full p-2.5 bg-slate-950 border-slate-800 rounded text-white"><input type="date" id="nota-data" class="w-full p-2.5 bg-slate-950 border-slate-800 rounded text-white"><input id="nota-link" placeholder="Link do Drive" class="w-full p-2.5 bg-slate-950 border-slate-800 rounded text-white"><button class="w-full bg-indigo-600 py-2 rounded text-white font-bold">Salvar</button></form></div><div id="lista-notas" class="lg:col-span-2 space-y-3"></div></div></div>

                <!-- OUTROS -->
                <div id="view-sem_retorno" class="view-section hidden fade-in"><h3 class="text-white mb-4">Sem Retorno</h3><div id="lista-sem-retorno" class="space-y-2"></div></div>
                <div id="view-ativos" class="view-section hidden fade-in"><h3 class="text-white mb-4">Ativos</h3><div id="lista-ativos-grid" class="grid grid-cols-2 gap-4"></div></div>
                <div id="view-contratos" class="view-section hidden fade-in"><h3 class="text-white mb-4">Contratos</h3><div id="lista-contratos" class="grid grid-cols-2 gap-4"></div></div>
                <div id="view-inativos" class="view-section hidden fade-in"><h3 class="text-white mb-4">Inativos</h3><div id="lista-inativos" class="space-y-2"></div></div>
                <div id="view-perfil" class="view-section hidden fade-in"><div class="bg-slate-900 p-6 rounded max-w-xl mx-auto"><h3 class="text-white mb-4">Perfil</h3><form onsubmit="salvarPerfil(event)" class="space-y-4"><input id="prof-company" placeholder="Empresa" class="w-full p-3 bg-slate-950 rounded text-white"><input id="prof-name" placeholder="Nome" class="w-full p-3 bg-slate-950 rounded text-white"><input id="prof-email" placeholder="Email" class="w-full p-3 bg-slate-950 rounded text-white"><button class="bg-blue-600 px-6 py-2 rounded text-white font-bold">Salvar</button></form></div></div>
            </main>
        </div>
    </div>

    <!-- MODALS -->
    <div id="modal-config" class="hidden fixed inset-0 z-50 bg-slate-950/90 flex items-center justify-center p-4 backdrop-blur-sm"><div class="bg-slate-900 p-6 rounded-xl border border-slate-700 w-full max-w-md"><h3 class="text-white mb-4">Configurar IA</h3><input type="password" id="input-api-key" placeholder="API Key" class="w-full p-2 bg-slate-950 border border-slate-700 rounded text-white mb-4"><div class="flex justify-end gap-2"><button onclick="document.getElementById('modal-config').classList.add('hidden')" class="text-slate-400">Cancelar</button><button onclick="salvarConfig()" class="bg-blue-600 px-4 py-2 rounded text-white">Salvar</button></div></div></div>
    <div id="modal-ai" class="hidden fixed inset-0 z-[200] bg-slate-950/90 flex items-center justify-center p-4 backdrop-blur-sm"><div class="bg-slate-900 p-6 rounded-2xl w-full max-w-2xl"><h3 class="text-white mb-4">IA</h3><textarea id="ai-content" class="w-full h-64 bg-slate-950 text-slate-300 p-4 rounded mb-4"></textarea><button onclick="fecharAI()" class="bg-blue-600 px-4 py-2 rounded text-white">Fechar</button></div></div>
    <div id="custom-input-box-container"></div>

    <!-- FIREBASE MODULE TYPE -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, where, onSnapshot, doc, updateDoc, deleteDoc, getDoc, setDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // SUAS CHAVES DO FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyDSdQylysTQm4JyBGS6GPGO6MhI0rh6rMo",
            authDomain: "gestorpro-saas.firebaseapp.com",
            projectId: "gestorpro-saas",
            storageBucket: "gestorpro-saas.firebasestorage.app",
            messagingSenderId: "653082894438",
            appId: "1:653082894438:web:4333cab368003c27d34da7"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        let currentUser = null;
        let cachePJ = [];
        let unsubLeads, unsubPJ, unsubPF, unsubScripts, unsubNotas;

        // Auth Listeners
        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                document.getElementById('user-email-display').innerText = user.email;
                document.getElementById('login-overlay').classList.add('opacity-0', 'pointer-events-none');
                document.getElementById('app-content').classList.remove('opacity-0', 'pointer-events-none');
                document.getElementById('app-content').classList.remove('blur-content');
                iniciarListeners(user.uid); 
                initBackgroundAnimation(); 
            } else {
                currentUser = null;
                document.getElementById('login-overlay').classList.remove('opacity-0', 'pointer-events-none');
                document.getElementById('app-content').classList.add('opacity-0', 'pointer-events-none');
                document.getElementById('app-content').classList.add('blur-content');
                initBackgroundAnimation();
            }
        });

        // LOGIN COM AUTO-REGISTRO DE SEGURANÇA
        document.getElementById('login-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const pass = document.getElementById('login-pass').value;
            const btn = document.getElementById('login-btn');
            const msg = document.getElementById('login-msg');
            const originalText = btn.innerHTML;
            
            btn.innerHTML = '<i class="ph-bold ph-spinner animate-spin"></i>';
            msg.classList.add('hidden');
            
            signInWithEmailAndPassword(auth, email, pass)
            .catch((error) => {
                if(error.code === 'auth/user-not-found' || error.code === 'auth/invalid-credential') {
                    if(confirm("Usuário não encontrado. Deseja criar esta conta agora?")) {
                         createUserWithEmailAndPassword(auth, email, pass)
                         .then(() => alert("Conta criada! Entrando..."))
                         .catch(err => {
                             msg.innerText = "Erro ao criar: " + err.message;
                             msg.classList.remove('hidden');
                             btn.innerHTML = originalText;
                         });
                    } else {
                        msg.innerText = "Erro: Credenciais inválidas.";
                        msg.classList.remove('hidden');
                        btn.innerHTML = originalText;
                    }
                } else {
                    msg.innerText = "Erro: " + error.code;
                    msg.classList.remove('hidden');
                    btn.innerHTML = originalText;
                }
            });
        });

        window.logout = () => {
            if(unsubLeads) unsubLeads();
            if(unsubPJ) unsubPJ();
            if(unsubPF) unsubPF();
            if(unsubScripts) unsubScripts();
            if(unsubNotas) unsubNotas();
            signOut(auth);
        };

        // Firestore Listeners
        function iniciarListeners(uid) {
            unsubLeads = onSnapshot(query(collection(db, "leads"), where("userId", "==", uid)), (snap) => {
                const leads = []; snap.forEach(d => leads.push({id:d.id, ...d.data()})); renderLeads(leads);
            });
            unsubPJ = onSnapshot(query(collection(db, "financeiro_pj"), where("userId", "==", uid)), (snap) => {
                const t = []; snap.forEach(d => t.push({id:d.id, ...d.data()})); cachePJ = t; renderFinanceiro(t, 'pj'); calcularSaudeFinanceira();
            });
            unsubPF = onSnapshot(query(collection(db, "financeiro_pf"), where("userId", "==", uid)), (snap) => {
                const t = []; snap.forEach(d => t.push({id:d.id, ...d.data()})); renderFinanceiro(t, 'pf');
            });
            unsubScripts = onSnapshot(query(collection(db, "scripts"), where("userId", "==", uid)), (snap) => {
                const s = []; snap.forEach(d => s.push({id:d.id, ...d.data()})); renderScripts(s);
            });
            unsubNotas = onSnapshot(query(collection(db, "notas"), where("userId", "==", uid)), (snap) => {
                const n = []; snap.forEach(d => n.push({id:d.id, ...d.data()})); renderNotas(n);
            });
            getDoc(doc(db, "profiles", uid)).then(docSnap => {
                if(docSnap.exists()) {
                    const data = docSnap.data();
                    document.getElementById('prof-company').value = data.company || '';
                    document.getElementById('prof-name').value = data.name || '';
                    document.getElementById('prof-email').value = data.email || '';
                }
            });
        }

        // Funções de Dados
        window.adicionarLead = async (e) => {
            e.preventDefault();
            await addDoc(collection(db, "leads"), { userId: currentUser.uid, nome: document.getElementById('lead-nome').value, empresa: document.getElementById('lead-empresa').value, doc: document.getElementById('lead-doc').value, social: document.getElementById('lead-social').value, valor: parseFloat(document.getElementById('lead-valor').value)||0, status: 'negociacao', createdAt: new Date() });
            e.target.reset(); mostrarToast('Lead salvo!');
        };

        window.alterarStatusLead = async (id, novoStatus, valor, nome) => {
            await updateDoc(doc(db, "leads", id), { status: novoStatus });
            if(novoStatus === 'ganho') await addDoc(collection(db, "financeiro_pj"), { userId: currentUser.uid, op: 'entrada', desc: `Fechamento: ${nome}`, valor: valor, data: new Date().toISOString().split('T')[0], leadId: id });
            
            if(novoStatus !== 'ganho') {
                 const q = query(collection(db, "financeiro_pj"), where("leadId", "==", id));
                 const snap = await getDocs(q);
                 snap.forEach(d => deleteDoc(d.ref));
            }
        };

        window.adicionarTransacao = async (e, tipo) => {
            e.preventDefault();
            const op = document.querySelector(`input[name="${tipo}-tipo"]:checked`).value;
            const desc = document.getElementById(`${tipo}-desc`).value;
            const valor = parseFloat(document.getElementById(`${tipo}-valor`).value);
            const data = document.getElementById(`${tipo}-data`).value;
            const modalidade = document.getElementById(`${tipo}-modalidade`).value;
            const parcelas = parseInt(document.getElementById(`${tipo}-parcelas`)?.value) || 1;
            const collectionName = tipo === 'pj' ? 'financeiro_pj' : 'financeiro_pf';
            
            let loop = modalidade === 'unico' ? 1 : (modalidade === 'parcelado' ? parcelas : (modalidade === 'recorrente' ? 12 : 1));
            let dateObj = new Date(data);

            for(let i=0; i<loop; i++) {
                let curDesc = desc; if(modalidade === 'parcelado') curDesc += ` (${i+1}/${loop})`;
                let newDate = new Date(dateObj); newDate.setMonth(newDate.getMonth() + i);
                await addDoc(collection(db, collectionName), { userId: currentUser.uid, op, desc: curDesc, valor, data: newDate.toISOString().split('T')[0], modalidade, createdAt: new Date() });
            }
            e.target.reset(); mostrarToast('Lançamento salvo!');
        };

        window.adicionarScript = async (e) => {
            e.preventDefault();
            await addDoc(collection(db, "scripts"), { userId: currentUser.uid, titulo: document.getElementById('script-titulo').value, texto: document.getElementById('script-texto').value });
            e.target.reset(); mostrarToast('Script salvo!');
        };
        
        window.adicionarNota = async (e) => {
            e.preventDefault();
            await addDoc(collection(db, "notas"), { 
                userId: currentUser.uid, 
                numero: document.getElementById('nota-numero').value,
                cliente: document.getElementById('nota-cliente').value,
                valor: parseFloat(document.getElementById('nota-valor').value)||0,
                data: document.getElementById('nota-data').value,
                link: document.getElementById('nota-link').value,
                status: 'emitida'
            });
            e.target.reset(); mostrarToast('Nota salva!');
        };

        window.excluirItem = async (col, id) => { if(confirm('Apagar?')) await deleteDoc(doc(db, col, id)); };

        window.salvarPerfil = async (e) => {
            e.preventDefault();
            await setDoc(doc(db, "profiles", currentUser.uid), {
                company: document.getElementById('prof-company').value,
                name: document.getElementById('prof-name').value,
                email: document.getElementById('prof-email').value
            }, { merge: true });
            mostrarToast('Perfil salvo!');
        };

        window.toggleModalidade = (tipo) => {
            const val = document.getElementById(`${tipo}-modalidade`).value;
            const container = document.getElementById(`${tipo}-parcelas-container`);
            if(val === 'unico') container.classList.add('hidden');
            else container.classList.remove('hidden');
        };
        
        // Edição de Valor Lead
        window.editarValorLead = (id) => {
             getDoc(doc(db, "leads", id)).then(snap => {
                 if(snap.exists()) {
                     const l = snap.data();
                     const box = document.createElement('div');
                     box.id = 'custom-input-box';
                     box.className = 'fixed inset-0 z-[300] bg-slate-900/90 flex items-center justify-center p-4 backdrop-blur-sm';
                     box.innerHTML = `
                        <div class="bg-white dark:bg-slate-900 p-6 rounded-2xl shadow-2xl max-w-md w-full border border-slate-200 dark:border-slate-700 animate-in zoom-in-95 duration-200">
                            <h3 class="text-lg font-bold text-slate-800 dark:text-white mb-4">Editar Lead</h3>
                            <div class="space-y-3">
                                <input type="text" id="edit-nome" value="${l.nome}" class="w-full p-2.5 border rounded-lg bg-slate-50 dark:bg-slate-800 dark:text-white">
                                <input type="number" id="edit-valor" value="${l.valor}" class="w-full p-2.5 border rounded-lg bg-slate-50 dark:bg-slate-800 dark:text-white">
                            </div>
                            <div class="flex gap-2 mt-6">
                                <button onclick="document.getElementById('custom-input-box').remove()" class="flex-1 py-2.5 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 rounded-xl">Cancelar</button>
                                <button onclick="confirmarEdicaoValor('${id}')" class="flex-1 py-2.5 bg-blue-600 text-white rounded-xl">Salvar</button>
                            </div>
                        </div>`;
                     document.body.appendChild(box);
                 }
             });
        };
        
        window.confirmarEdicaoValor = async (id) => {
            const nome = document.getElementById('edit-nome').value;
            const valor = parseFloat(document.getElementById('edit-valor').value);
            await updateDoc(doc(db, "leads", id), { nome, valor });
            
            const q = query(collection(db, "financeiro_pj"), where("leadId", "==", id));
            const snap = await getDocs(q);
            snap.forEach(d => updateDoc(d.ref, { valor, desc: `Fechamento: ${nome}` }));
            
            document.getElementById('custom-input-box').remove();
            mostrarToast('Atualizado!');
        };

        // Renderização
        function renderLeads(leads) {
            const list = document.getElementById('lista-leads'); list.innerHTML = '';
            const listSem = document.getElementById('lista-sem-retorno'); if(listSem) listSem.innerHTML = '';
            const listAti = document.getElementById('lista-ativos-grid'); if(listAti) listAti.innerHTML = '';
            const listCon = document.getElementById('lista-contratos'); if(listCon) listCon.innerHTML = '';
            const listIna = document.getElementById('lista-inativos'); if(listIna) listIna.innerHTML = '';

            let totalPot = 0, totalAti = 0;
            leads.forEach(l => {
                if(l.status === 'negociacao') totalPot += l.valor;
                if(l.status === 'ganho') totalAti += l.valor;
                
                const card = `<div class="bg-slate-900 p-4 rounded-xl border border-slate-800 flex justify-between items-center shadow-sm mb-2"><div><div class="font-bold text-white">${l.nome}</div><div class="text-sm text-slate-400">${l.empresa} - ${formatMoney(l.valor)}</div></div><div class="flex gap-2"><button onclick="alterarStatusLead('${l.id}','ganho',${l.valor},'${l.nome}')" class="text-emerald-500 p-2"><i class="ph-bold ph-check"></i></button><button onclick="alterarStatusLead('${l.id}','sem_retorno',0,'')" class="text-amber-500 p-2"><i class="ph-bold ph-clock"></i></button><button onclick="editarValorLead('${l.id}')" class="text-blue-500 p-2"><i class="ph-bold ph-pencil-simple"></i></button><button onclick="excluirItem('leads','${l.id}')" class="text-slate-500 p-2"><i class="ph-bold ph-trash"></i></button></div></div>`;
                
                if(l.status === 'negociacao') list.innerHTML += card;
                if(l.status === 'sem_retorno' && listSem) listSem.innerHTML += card.replace('text-amber-500','hidden'); 
                if(l.status === 'ganho' && listAti) listAti.innerHTML += `<div class="bg-slate-900 p-5 rounded-xl border border-emerald-900/30"><div class="font-bold text-white">${l.nome}</div><div class="text-emerald-400 font-bold">${formatMoney(l.valor)}</div><button onclick="alterarStatusLead('${l.id}','inativo',0,'')" class="text-xs mt-2 bg-slate-800 px-2 py-1 rounded text-slate-400 hover:text-white">Desativar</button></div>`;
                if(l.status === 'ganho' && listCon) listCon.innerHTML += `<div class="bg-slate-900 p-5 rounded-xl border border-slate-800"><div>${l.nome}</div><div class="text-xs text-slate-500">Contrato Ativo</div><div class="mt-2 text-emerald-400 font-bold">${formatMoney(l.valor)}</div></div>`;
                if((l.status === 'perdido' || l.status === 'inativo') && listIna) listIna.innerHTML += `<div class="bg-slate-900 p-4 rounded border border-slate-800 opacity-50 flex justify-between"><div>${l.nome}</div><button onclick="excluirItem('leads','${l.id}')"><i class="ph-bold ph-trash"></i></button></div>`;
            });
            document.getElementById('crm-potencial').innerText = formatMoney(totalPot);
            document.getElementById('crm-ativos').innerText = formatMoney(totalAti);
        }

        function renderFinanceiro(dados, tipo) {
            const ent = dados.filter(t=>t.op==='entrada').reduce((a,b)=>a+b.valor,0);
            const sai = dados.filter(t=>t.op==='saida').reduce((a,b)=>a+b.valor,0);
            document.getElementById(`${tipo}-receita`).innerText = formatMoney(ent);
            document.getElementById(`${tipo}-despesa`).innerText = formatMoney(sai);
            document.getElementById(`${tipo}-saldo`).innerText = formatMoney(ent-sai);
            
            const list = document.getElementById(`lista-transacoes-${tipo}`); list.innerHTML = '';
            dados.sort((a,b)=>new Date(b.data)-new Date(a.data)).forEach(t => {
                list.innerHTML += `<tr class="border-b border-slate-800"><td class="p-3 text-slate-300">${t.desc}<div class="text-xs text-slate-500">${new Date(t.data).toLocaleDateString()}</div></td><td class="p-3 text-right ${t.op==='entrada'?'text-emerald-400':'text-rose-400'}">${formatMoney(t.valor)}</td><td class="p-3 text-right"><button onclick="excluirItem('${tipo==='pj'?'financeiro_pj':'financeiro_pf'}','${t.id}')"><i class="ph-bold ph-trash"></i></button></td></tr>`;
            });
            atualizarGrafico(tipo, ent, sai);
        }

        function renderScripts(scripts) {
            const div = document.getElementById('lista-scripts'); div.innerHTML = '';
            scripts.forEach(s => {
                div.innerHTML += `<div class="bg-slate-900 p-4 rounded border border-slate-800 mb-2"><h4 class="font-bold text-white">${s.titulo}</h4><p class="text-sm text-slate-400 mt-2 whitespace-pre-wrap">${s.texto}</p><button onclick="excluirItem('scripts','${s.id}')" class="mt-2 text-rose-500 text-xs">Excluir</button></div>`;
            });
        }
        
        function renderNotas(notas) {
            const div = document.getElementById('lista-notas'); div.innerHTML = '';
            notas.forEach(n => {
                div.innerHTML += `<div class="bg-slate-900 p-4 rounded border border-slate-800 mb-2 flex justify-between"><div><div class="font-bold text-white">#${n.numero} - ${n.cliente}</div><div class="text-xs text-slate-400">${formatMoney(n.valor)}</div></div><button onclick="excluirItem('notas','${n.id}')" class="text-rose-500"><i class="ph-bold ph-trash"></i></button></div>`;
            });
        }

        let chartInstancePJ = null;
        let chartInstancePF = null;
        function atualizarGrafico(tipo, entradas, saidas) {
            const ctx = document.getElementById(`grafico-${tipo}`)?.getContext('2d');
            if(!ctx) return;
            const config = {
                type: 'bar',
                data: {
                    labels: ['Entradas', 'Saídas'],
                    datasets: [{
                        data: [entradas, saidas],
                        backgroundColor: [tipo==='pj'?'#10b981':'#3b82f6', tipo==='pj'?'#f43f5e':'#f97316'],
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true, grid: { color: '#334155' } }, x: { grid: { display: false } } }
                }
            };
            if(tipo === 'pj') { if(chartInstancePJ) chartInstancePJ.destroy(); chartInstancePJ = new Chart(ctx, config); }
            else { if(chartInstancePF) chartInstancePF.destroy(); chartInstancePF = new Chart(ctx, config); }
        }

        window.calcularSaudeFinanceira = () => {
            const ent = cachePJ.filter(t=>t.op==='entrada').reduce((a,b)=>a+b.valor,0);
            const sai = cachePJ.filter(t=>t.op==='saida').reduce((a,b)=>a+b.valor,0);
            const lucro = ent - sai;
            const perc = parseInt(document.getElementById('input-reserva').value)||20;
            const status = document.getElementById('label-saude-status');
            const bar = document.getElementById('bar-saude-fill');
            
            if(lucro <= 0) {
                status.innerText = "Prejuízo"; status.className = "text-rose-500 font-bold";
                bar.className = "h-full bg-rose-500 w-full";
                document.getElementById('val-meu-salario').innerText = "R$ 0,00";
            } else {
                status.innerText = "Positivo"; status.className = "text-emerald-400 font-bold";
                bar.className = "h-full bg-emerald-500";
                bar.style.width = "100%";
                document.getElementById('val-meu-salario').innerText = formatMoney(lucro * ((100-perc)/100));
            }
        };

        const formatMoney = (val) => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(val);
        function mostrarToast(msg) { const t = document.getElementById('toast'); t.innerText = msg; t.classList.remove('hidden', 'translate-y-10', 'opacity-0'); setTimeout(() => { t.classList.add('translate-y-10', 'opacity-0'); setTimeout(() => t.classList.add('hidden'), 300); }, 3000); }
        window.mudarAba = (aba) => { document.querySelectorAll('.view-section').forEach(e => e.classList.add('hidden')); document.getElementById(`view-${aba}`).classList.remove('hidden'); };
        window.toggleSidebar = () => { document.getElementById('sidebar').classList.toggle('sidebar-closed'); };
        
        function initBackgroundAnimation() {
            const cvs = document.getElementById('login-bg-canvas'); if(!cvs) return; const ctx = cvs.getContext('2d');
            let w, h, p = []; const resize = () => { w = cvs.width = window.innerWidth; h = cvs.height = window.innerHeight; };
            window.addEventListener('resize', resize); resize();
            for(let i=0;i<60;i++)p.push({x:Math.random()*w,y:Math.random()*h,vx:(Math.random()-.5),vy:(Math.random()-.5)});
            function anim() { ctx.clearRect(0,0,w,h); ctx.fillStyle='rgba(100,150,255,0.4)'; p.forEach(pt=>{pt.x+=pt.vx;pt.y+=pt.vy;if(pt.x<0||pt.x>w)pt.vx*=-1;if(pt.y<0||pt.y>h)pt.vy*=-1;ctx.beginPath();ctx.arc(pt.x,pt.y,2,0,Math.PI*2);ctx.fill()}); requestAnimationFrame(anim); }
            anim();
        }

        // --- FUNÇÕES DE AUXÍLIO PARA UI (Configuração e IA) ---
        window.abrirConfig = () => document.getElementById('modal-config').classList.remove('hidden');
        window.salvarConfig = () => { localStorage.setItem('gemini_api_key', document.getElementById('input-api-key').value); document.getElementById('modal-config').classList.add('hidden'); mostrarToast('Configuração salva!'); }
        
        window.gerarScriptIA = () => {
            const titulo = document.getElementById('script-titulo').value;
            if(!titulo) return mostrarToast("Digite um título.");
            const key = localStorage.getItem('gemini_api_key');
            if(!key) { abrirConfig(); return mostrarToast("Configure a API Key."); }
            
            document.getElementById('script-texto').value = "Gerando...";
            fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${key}`, {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({contents: [{parts: [{text: `Crie um script de venda curto e persuasivo para: ${titulo}`}]}]})
            }).then(r=>r.json()).then(d=>document.getElementById('script-texto').value=d.candidates[0].content.parts[0].text);
        };
        
        window.copiarTextoAI = () => { navigator.clipboard.writeText(document.getElementById('ai-content').innerText); mostrarToast('Copiado!'); }
        window.fecharAI = () => document.getElementById('modal-ai').classList.add('hidden');
        window.togglePrivacy = () => { showValues = !showValues; renderizar(); };
    </script>
</body>
</html>
