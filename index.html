<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor Pro - SaaS</title>
    
    <!-- === 1. BLINDAGEM MÁXIMA (Nível Militar) === -->
    <script>
        // 1. Bloqueio de Clique Direito
        document.addEventListener('contextmenu', event => event.preventDefault());

        // 2. Bloqueio de Teclas de Atalho
        document.onkeydown = function(e) {
            if (e.keyCode == 123) { return false; } // F12
            if (e.ctrlKey && e.shiftKey && e.keyCode == 'I'.charCodeAt(0)) { return false; } 
            if (e.ctrlKey && e.shiftKey && e.keyCode == 'C'.charCodeAt(0)) { return false; } 
            if (e.ctrlKey && e.shiftKey && e.keyCode == 'J'.charCodeAt(0)) { return false; } 
            if (e.ctrlKey && e.keyCode == 'U'.charCodeAt(0)) { return false; } 
            if (e.ctrlKey && e.keyCode == 'S'.charCodeAt(0)) { return false; } 
            if (e.ctrlKey && e.keyCode == 'P'.charCodeAt(0)) { return false; } 
            if (e.ctrlKey && e.keyCode == 'H'.charCodeAt(0)) { return false; } 
            if (e.ctrlKey && e.keyCode == 'A'.charCodeAt(0)) { return false; } 
            if (e.ctrlKey && e.keyCode == 'F'.charCodeAt(0)) { return false; } 
        };

        // 3. Sobrescreve Alert Nativo
        window.alert = function(msg) {
            if (!document.body) {
                window.addEventListener('DOMContentLoaded', function() {
                    window.alert(msg);
                });
                return;
            }

            const existing = document.getElementById('custom-alert-box');
            if(existing) existing.remove();

            const box = document.createElement('div');
            box.id = 'custom-alert-box';
            box.className = 'fixed inset-0 z-[300] bg-black/80 flex items-center justify-center p-4 backdrop-blur-sm fade-in';
            box.innerHTML = `
                <div class="bg-white dark:bg-slate-900 p-6 rounded-2xl shadow-2xl max-w-sm w-full border border-slate-200 dark:border-slate-700 animate-in zoom-in-95 duration-200">
                    <div class="mb-4 text-center">
                        <div class="bg-blue-100 dark:bg-blue-900/30 w-12 h-12 rounded-full flex items-center justify-center mx-auto text-blue-600 dark:text-blue-400 mb-3">
                            <i class="ph-bold ph-info text-2xl"></i>
                        </div>
                        <h3 class="text-xl font-bold text-slate-800 dark:text-white">Aviso do Sistema</h3>
                    </div>
                    <p class="text-slate-600 dark:text-slate-300 mb-6 text-center text-sm leading-relaxed">${msg}</p>
                    <button onclick="document.getElementById('custom-alert-box').remove()" class="w-full py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-bold shadow-lg shadow-blue-600/20 transition-all">Entendido</button>
                </div>
            `;
            document.body.appendChild(box);
        };
    </script>

    <!-- === 2. IMPORTAÇÃO DE BIBLIOTECAS === -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: { 
                extend: { 
                    colors: { 
                        slate: { 850: '#172033', 950: '#020617' } 
                    },
                    fontFamily: {
                        sans: ['Segoe UI', 'Roboto', 'sans-serif']
                    }
                } 
            }
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- === 3. ESTILOS CSS COMPLETOS === -->
    <style>
        body { 
            font-family: 'Segoe UI', sans-serif; 
            -webkit-user-select: none; 
            user-select: none; 
            overflow: hidden; 
            background-color: #020617;
            color: white;
        }
        
        input, textarea, select { 
            user-select: text; 
            cursor: text; 
        }
        
        .fade-in { 
            animation: fadeIn 0.3s ease-in-out; 
        }
        
        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(5px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }
        
        .blur-content { 
            filter: blur(10px); 
            pointer-events: none; 
            user-select: none; 
            overflow: hidden; 
            height: 100vh;
            opacity: 0.3;
            transition: all 0.5s ease;
        }
        
        .profile-img { object-fit: cover; }
        
        #sidebar { 
            transition: margin-left 0.3s ease-in-out, transform 0.3s ease-in-out; 
        }
        
        .sidebar-closed { margin-left: -18rem; } 
        
        @media (max-width: 1280px) {
            .sidebar-closed { margin-left: 0; transform: translateX(-100%); }
            .sidebar-open { transform: translateX(0); }
        }
        
        .health-bar-container { position: relative; overflow: hidden; }
        .health-bar-fill { transition: width 1s ease-in-out, background-color 0.5s ease; }

        .animate-blob {
            animation: float-blob 10s infinite alternate cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes float-blob {
            0% { transform: translate(0px, 0px) scale(1); }
            33% { transform: translate(30px, -50px) scale(1.1); }
            66% { transform: translate(-20px, 20px) scale(0.9); }
            100% { transform: translate(0px, 0px) scale(1); }
        }
        
        .animation-delay-2000 { animation-delay: 2s; }
        .animation-delay-4000 { animation-delay: 4s; }
    </style>
</head>
<body class="bg-slate-950 text-slate-100 h-screen w-screen overflow-hidden flex" id="body-container">

    <!-- === TELA DE LOGIN COM ANIMAÇÃO === -->
    <div id="login-overlay" class="fixed inset-0 z-[100] bg-slate-950 flex items-center justify-center p-4 transition-opacity duration-500">
        <!-- Canvas para Partículas -->
        <canvas id="login-bg-canvas" class="absolute inset-0 w-full h-full pointer-events-none z-0"></canvas>
        
        <!-- Gradiente de Fundo -->
        <div class="absolute inset-0 bg-gradient-to-b from-transparent to-slate-950/90 pointer-events-none z-0"></div>
        
        <!-- Luzes Animadas -->
        <div class="absolute inset-0 overflow-hidden pointer-events-none z-0">
            <div class="absolute top-[-10%] left-[-10%] w-96 h-96 bg-purple-600 rounded-full mix-blend-screen filter blur-[100px] opacity-40 animate-blob"></div>
            <div class="absolute top-[-10%] right-[-10%] w-96 h-96 bg-blue-600 rounded-full mix-blend-screen filter blur-[100px] opacity-40 animate-blob animation-delay-2000"></div>
            <div class="absolute bottom-[-20%] left-[20%] w-96 h-96 bg-indigo-600 rounded-full mix-blend-screen filter blur-[100px] opacity-40 animate-blob animation-delay-4000"></div>
        </div>

        <div class="relative w-full max-w-sm bg-white/5 dark:bg-slate-900/40 backdrop-blur-2xl rounded-3xl shadow-2xl border border-white/10 p-10 text-center animate-in zoom-in-95 duration-500 ring-1 ring-white/10 z-10">
            <div class="mb-8 flex justify-center">
                <div class="relative group cursor-pointer select-none">
                    <div class="absolute inset-0 bg-gradient-to-tr from-blue-500 to-purple-500 rounded-2xl blur-lg opacity-60 group-hover:opacity-100 transition-opacity duration-500"></div>
                    <div class="relative bg-slate-950 p-5 rounded-2xl border border-slate-800 shadow-xl group-hover:scale-105 transition-transform duration-300">
                        <i class="ph-fill ph-brain text-4xl text-transparent bg-clip-text bg-gradient-to-tr from-blue-400 to-purple-400"></i>
                    </div>
                </div>
            </div>

            <h2 class="text-3xl font-bold text-white mb-2 tracking-tight drop-shadow-md">Gestor Pro</h2>
            <p class="text-xs font-medium text-slate-400 uppercase tracking-widest mb-8 opacity-80">Acesso Cloud & Seguro</p>

            <form id="login-form" class="space-y-5 text-left">
                <div>
                    <div class="relative group">
                        <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                            <i class="ph-bold ph-envelope text-slate-400 group-focus-within:text-blue-400 transition-colors"></i>
                        </div>
                        <input type="email" id="login-email" placeholder="E-mail de Acesso" class="w-full py-4 pl-12 pr-4 bg-slate-950/50 border border-slate-700/50 rounded-2xl text-white placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500/50 transition-all font-medium backdrop-blur-sm" required>
                    </div>
                </div>
                <div>
                    <div class="relative group">
                        <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                            <i class="ph-bold ph-lock-key text-slate-400 group-focus-within:text-blue-400 transition-colors"></i>
                        </div>
                        <input type="password" id="login-pass" placeholder="Sua Senha" class="w-full py-4 pl-12 pr-12 bg-slate-950/50 border border-slate-700/50 rounded-2xl text-white placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500/50 transition-all font-medium backdrop-blur-sm" required>
                    </div>
                </div>
                <button type="submit" id="login-btn" class="w-full py-4 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 text-white rounded-2xl font-bold text-lg shadow-lg shadow-blue-600/30 hover:shadow-blue-600/50 transition-all transform active:scale-[0.98] border border-white/10 flex justify-center items-center gap-2">
                    <span>Entrar</span>
                </button>
            </form>
            <p id="login-msg" class="mt-6 text-xs text-rose-400 hidden text-center bg-rose-500/10 p-2 rounded border border-rose-500/20"></p>
        </div>
    </div>

    <!-- === ESTRUTURA PRINCIPAL === -->
    <div id="app-content" class="flex flex-row h-full w-full blur-content transition-all duration-500 overflow-hidden absolute inset-0 opacity-0 pointer-events-none">
        
        <!-- SIDEBAR COMPLETA -->
        <aside id="sidebar" class="absolute xl:relative z-50 w-72 h-full bg-slate-900 border-r border-slate-800 flex flex-col shadow-2xl xl:shadow-none flex-shrink-0 transform transition-transform duration-300 xl:translate-x-0 -translate-x-full">
            <div class="p-6 border-b border-slate-800 flex items-center gap-3 shrink-0">
                <div id="header-avatar" class="w-10 h-10 rounded-xl bg-blue-600 text-white flex items-center justify-center shadow-lg shadow-blue-600/20 overflow-hidden shrink-0"><i class="ph-bold ph-trend-up text-xl"></i></div>
                <div class="overflow-hidden"><h1 class="text-lg font-bold leading-none tracking-tight truncate text-white" id="header-name">Gestor Pro</h1><p id="user-email-display" class="text-[10px] text-slate-400 font-medium mt-1 uppercase tracking-wider truncate">Carregando...</p></div>
                <button onclick="toggleSidebar()" class="xl:hidden ml-auto text-slate-400 hover:text-slate-600"><i class="ph-bold ph-x text-xl"></i></button>
            </div>

            <nav class="flex-1 overflow-y-auto p-4 space-y-1.5 custom-scrollbar">
                <div class="text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 px-3 mt-2">Menu Principal</div>
                <button onclick="mudarAba('crm')" id="btn-crm" class="tab-btn w-full active px-4 py-3 rounded-xl text-sm font-semibold transition-all flex items-center gap-3 bg-blue-600 text-white shadow-md text-left"><i class="ph-bold ph-users text-lg"></i> Prospecção</button>
                <button onclick="mudarAba('scripts')" id="btn-scripts" class="tab-btn w-full px-4 py-3 rounded-xl text-sm font-medium transition-all text-slate-400 hover:bg-slate-800 hover:text-white flex items-center gap-3 text-left"><i class="ph-bold ph-chat-text text-lg"></i> Scripts</button>
                <button onclick="mudarAba('sem_retorno')" id="btn-sem_retorno" class="tab-btn w-full px-4 py-3 rounded-xl text-sm font-medium transition-all text-slate-400 hover:bg-slate-800 hover:text-white flex items-center gap-3 text-left"><i class="ph-bold ph-clock text-lg"></i> Sem Retorno</button>
                <button onclick="mudarAba('ativos')" id="btn-ativos" class="tab-btn w-full px-4 py-3 rounded-xl text-sm font-medium transition-all text-slate-400 hover:bg-slate-800 hover:text-white flex items-center gap-3 text-left"><i class="ph-bold ph-check-circle text-lg"></i> Ativos</button>
                <button onclick="mudarAba('contratos')" id="btn-contratos" class="tab-btn w-full px-4 py-3 rounded-xl text-sm font-medium transition-all text-slate-400 hover:bg-slate-800 hover:text-white flex items-center gap-3 text-left"><i class="ph-bold ph-file-text text-lg"></i> Contratos</button>
                <button onclick="mudarAba('notas')" id="btn-notas" class="tab-btn w-full px-4 py-3 rounded-xl text-sm font-medium transition-all text-slate-400 hover:bg-slate-800 hover:text-white flex items-center gap-3 text-left"><i class="ph-bold ph-receipt text-lg"></i> Notas Fiscais</button>
                <button onclick="mudarAba('inativos')" id="btn-inativos" class="tab-btn w-full px-4 py-3 rounded-xl text-sm font-medium transition-all text-slate-400 hover:bg-slate-800 hover:text-white flex items-center gap-3 text-left"><i class="ph-bold ph-user-minus text-lg"></i> Inativos</button>
                
                <div class="border-t border-slate-800 my-4 mx-3"></div>
                <div class="text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 px-3">Financeiro</div>
                <button onclick="mudarAba('financeiro')" id="btn-financeiro" class="tab-btn w-full px-4 py-3 rounded-xl text-sm font-medium transition-all text-slate-400 hover:bg-slate-800 hover:text-white flex items-center gap-3 text-left"><i class="ph-bold ph-briefcase text-lg"></i> Empresa</button>
                <button onclick="mudarAba('pessoal')" id="btn-pessoal" class="tab-btn w-full px-4 py-3 rounded-xl text-sm font-medium transition-all text-slate-400 hover:bg-slate-800 hover:text-white flex items-center gap-3 text-left"><i class="ph-bold ph-house text-lg"></i> Pessoal</button>
                
                <div class="border-t border-slate-800 my-4 mx-3"></div>
                <button onclick="logout()" class="w-full px-4 py-3 rounded-xl text-sm font-medium transition-all text-rose-400 hover:bg-rose-900/20 flex items-center gap-3 text-left"><i class="ph-bold ph-sign-out text-lg"></i> Sair</button>
            </nav>

            <div class="p-4 border-t border-slate-800 bg-slate-900/50 shrink-0">
                <button onclick="mudarAba('perfil')" id="btn-perfil" class="tab-btn w-full mb-3 px-4 py-2.5 rounded-xl text-sm font-medium transition-all text-slate-400 hover:bg-slate-800 hover:shadow-sm flex items-center gap-3 border border-transparent hover:border-slate-700"><i class="ph-bold ph-user-gear text-lg"></i> Meu Perfil</button>
                <div class="flex items-center justify-between gap-2">
                    <button onclick="togglePrivacy()" id="btn-eye-desktop" class="flex-1 p-2.5 rounded-lg bg-slate-800 text-slate-400 hover:bg-slate-700 hover:text-white transition-colors border border-slate-700 shadow-sm" title="Ocultar Valores"><i class="ph-bold ph-eye text-lg"></i></button>
                    <button onclick="abrirConfig()" class="flex-1 p-2.5 rounded-lg bg-slate-800 text-slate-400 hover:bg-slate-700 hover:text-white transition-colors border border-slate-700 shadow-sm" title="Configurações e API"><i class="ph-bold ph-gear text-lg"></i></button>
                    <button class="flex-1 p-2.5 rounded-lg bg-slate-800 text-slate-500 cursor-not-allowed border border-slate-700 shadow-sm" title="Modo Escuro Fixo"><i class="ph-fill ph-moon text-lg"></i></button>
                    <button onclick="bloquearTela()" class="flex-1 p-2.5 rounded-lg bg-slate-800 text-rose-500 hover:bg-rose-900/20 hover:text-rose-400 transition-colors border border-slate-700 shadow-sm" title="Bloquear"><i class="ph-bold ph-lock-key text-lg"></i></button>
                </div>
            </div>
        </aside>

        <div id="sidebar-overlay" onclick="toggleSidebar()" class="fixed inset-0 bg-black/50 z-40 hidden xl:hidden backdrop-blur-sm transition-opacity"></div>

        <!-- ÁREA DIREITA -->
        <div class="flex-1 flex flex-col h-full min-w-0 bg-slate-950 relative overflow-hidden">
            <header class="xl:hidden bg-slate-900 border-b border-slate-800 shrink-0 z-30 px-4 py-3 flex items-center justify-between shadow-sm">
                <div class="flex items-center gap-3"><button onclick="toggleSidebar()" class="p-2 -ml-2 text-slate-300 hover:bg-slate-800 rounded-lg"><i class="ph-bold ph-list text-2xl"></i></button><span class="font-bold text-lg text-white">Gestor Pro</span></div>
                <div class="flex gap-2">
                    <button onclick="togglePrivacy()" id="btn-eye-mobile" class="p-2 text-slate-500 dark:text-slate-400"><i class="ph-bold ph-eye text-xl"></i></button>
                    <button onclick="toggleDarkMode()" class="p-2 text-slate-500 dark:text-slate-400"><i class="ph-fill ph-moon text-xl"></i></button>
                </div>
            </header>

            <main class="flex-1 overflow-y-auto scroll-smooth relative p-6" id="main-scroll-area">
                <div id="toast" class="hidden fixed bottom-6 right-6 bg-slate-800 text-white px-6 py-3 rounded-lg shadow-xl z-[300] font-medium transform transition-all duration-300 translate-y-10 opacity-0 border border-slate-700 shadow-blue-900/20"></div>

                <!-- VIEW CRM -->
                <div id="view-crm" class="view-section fade-in">
                    <div class="sticky top-0 z-40 bg-slate-950 px-4 md:px-8 py-6 border-b border-slate-800 shadow-sm transition-all w-full">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                            <div class="bg-slate-900 p-5 rounded-2xl border border-slate-800 shadow-sm relative overflow-hidden group"><div class="absolute right-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity"><i class="ph-fill ph-trend-up text-6xl text-blue-600"></i></div><p class="text-xs text-slate-400 font-bold uppercase tracking-wider">Em Negociação</p><h3 class="text-2xl font-bold text-blue-400 mt-1" id="crm-potencial">R$ 0,00</h3><div class="mt-2 text-xs font-medium text-slate-400"><span id="crm-count-negociacao">0</span> leads</div></div>
                            <div class="bg-slate-900 p-5 rounded-2xl border-l-4 border-emerald-600 shadow-sm border-slate-800"><div class="flex justify-between items-start"><div><p class="text-xs text-slate-400 font-bold uppercase tracking-wider">Em Carteira (Ativos)</p><h3 class="text-2xl font-bold text-emerald-400 mt-1" id="crm-ativos">R$ 0,00</h3></div><div class="bg-emerald-900/30 p-1.5 rounded-lg text-emerald-400"><i class="ph-bold ph-wallet text-xl"></i></div></div><p class="text-xs text-slate-400 mt-2"><span id="crm-count-ativos">0</span> fechados</p></div>
                            <div class="bg-slate-900 p-5 rounded-2xl border-l-4 border-amber-600 shadow-sm border-slate-800 relative overflow-hidden"><div class="flex justify-between items-start"><div><p class="text-xs text-slate-400 font-bold uppercase tracking-wider">Sem Retorno</p><h3 class="text-2xl font-bold text-amber-400 mt-1" id="crm-sem-retorno">R$ 0,00</h3></div><div class="bg-amber-900/30 p-1.5 rounded-lg text-amber-400"><i class="ph-bold ph-clock text-xl"></i></div></div><p class="text-xs text-slate-400 mt-2"><span id="crm-count-sem-retorno">0</span> aguardando</p></div>
                            <div class="bg-slate-900 p-5 rounded-2xl border-l-4 border-slate-600 shadow-sm border-slate-800"><div class="flex justify-between items-start"><div><p class="text-xs text-slate-400 font-bold uppercase tracking-wider">Perdidos / Inativos</p><h3 class="text-2xl font-bold text-slate-300 mt-1" id="crm-inativos">R$ 0,00</h3></div><div class="bg-slate-800 p-1.5 rounded-lg text-slate-400"><i class="ph-bold ph-prohibit text-xl"></i></div></div><p class="text-xs text-slate-400 mt-2"><span id="crm-count-inativos">0</span> cancelados</p></div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 px-4 md:px-8 py-6">
                        <div class="lg:col-span-1">
                            <div class="bg-slate-900 p-5 rounded-2xl shadow-sm border border-slate-800 sticky top-48">
                                <h3 class="font-bold text-lg mb-5 flex items-center gap-2 text-slate-800 dark:text-white"><span class="bg-blue-900/30 text-blue-400 p-1.5 rounded-lg"><i class="ph-bold ph-plus"></i></span> Novo Lead</h3>
                                <form onsubmit="adicionarLead(event)" class="space-y-4">
                                    <div><label class="block text-xs font-bold text-slate-500 dark:text-slate-400 mb-1 uppercase">Nome do Cliente *</label><input type="text" id="lead-nome" placeholder="Ex: João Silva" required class="w-full p-2.5 border border-slate-700 rounded-lg bg-slate-950 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"></div>
                                    <div class="grid grid-cols-2 gap-3"><div><label class="block text-xs font-bold text-slate-500 dark:text-slate-400 mb-1 uppercase">Empresa</label><input type="text" id="lead-empresa" placeholder="Nome Fantasia" class="w-full p-2.5 border border-slate-700 rounded-lg bg-slate-950 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all text-sm"></div><div><label class="block text-xs font-bold text-slate-500 dark:text-slate-400 mb-1 uppercase">CPF / CNPJ</label><input type="text" id="lead-doc" placeholder="000.000..." class="w-full p-2.5 border border-slate-700 rounded-lg bg-slate-950 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all text-sm"></div></div>
                                    <div><label class="block text-xs font-bold text-slate-500 dark:text-slate-400 mb-1 uppercase">Rede Social (Link)</label><div class="relative"><div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><i class="ph-bold ph-link text-slate-400"></i></div><input type="text" id="lead-social" placeholder="instagram.com/cliente" class="w-full pl-10 p-2.5 border border-slate-700 rounded-lg bg-slate-950 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all text-sm"></div></div>
                                    <div><label class="block text-xs font-bold text-slate-500 dark:text-slate-400 mb-1 uppercase">Valor Estimado (R$)</label><input type="number" id="lead-valor" placeholder="0,00" step="0.01" class="w-full p-2.5 border border-slate-700 rounded-lg bg-slate-950 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"></div>
                                    <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-xl font-semibold transition-all shadow-lg shadow-blue-600/20 flex justify-center items-center gap-2"><i class="ph-bold ph-floppy-disk"></i> Cadastrar Lead</button>
                                </form>
                            </div>
                        </div>
                        <div class="lg:col-span-2 space-y-4">
                            <div class="sticky top-48 z-30 bg-slate-950 py-2 flex justify-between items-center mb-2">
                                <h3 class="font-bold text-lg text-slate-700 dark:text-white">Pipeline Organizado</h3>
                                <div class="bg-blue-900/20 text-blue-400 px-3 py-1 rounded-lg text-sm font-bold border border-blue-800">Total Geral: <span id="total-negociacao-list">R$ 0,00</span></div>
                            </div>
                            <div id="lista-leads" class="space-y-6"></div>
                        </div>
                    </div>
                </div>

                <!-- VIEW FINANCEIRO (EMPRESA) -->
                <div id="view-financeiro" class="view-section hidden fade-in">
                    <div class="sticky top-0 z-40 bg-slate-950 px-4 md:px-8 py-6 border-b border-slate-800 shadow-sm w-full">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="bg-slate-900 p-4 rounded-xl border-l-4 border-emerald-500 shadow-sm"><p class="text-sm text-emerald-400 font-bold">Receita Total</p><h3 class="text-2xl font-bold text-emerald-300" id="pj-receita">R$ 0,00</h3></div>
                            <div class="bg-slate-900 p-4 rounded-xl border-l-4 border-rose-500 shadow-sm"><p class="text-sm text-rose-400 font-bold">Despesas</p><h3 class="text-2xl font-bold text-rose-300" id="pj-despesa">R$ 0,00</h3></div>
                            <div class="bg-slate-900 p-4 rounded-xl border-l-4 border-blue-500 shadow-sm"><div class="flex justify-between"><p class="text-sm text-slate-400 font-bold">Saldo em Caixa</p><button onclick="gerarAnaliseFinanceira('pj')" class="text-xs bg-purple-900/30 text-purple-400 px-2 py-1 rounded-lg hover:bg-purple-900/50 flex items-center gap-1 font-bold" title="Gerar Análise com IA"><i class="ph-bold ph-sparkle"></i> Analisar (IA)</button></div><h3 class="text-2xl font-bold text-slate-700 dark:text-white" id="pj-saldo">R$ 0,00</h3></div>
                        </div>

                        <!-- === MEDIDOR DE SAÚDE FINANCEIRA === -->
                        <div id="painel-saude-financeira" class="mt-6 bg-slate-900 p-5 rounded-xl border border-slate-800 shadow-sm">
                            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-4 border-b border-slate-800 pb-4">
                                <h3 class="font-bold text-slate-800 dark:text-white flex items-center gap-2">
                                    <i class="ph-fill ph-heartbeat text-rose-500 text-xl"></i> Distribuição Inteligente de Lucro
                                </h3>
                                <div class="flex items-center gap-2 bg-slate-800 p-1.5 rounded-lg border border-slate-700">
                                    <span class="text-xs font-bold text-slate-500 dark:text-slate-400 uppercase">Retenção (Caixa):</span>
                                    <input type="number" id="input-percentual-reserva" min="0" max="100" value="20" class="w-16 bg-slate-900 border border-slate-600 rounded text-center text-sm font-bold focus:outline-none focus:ring-1 focus:ring-blue-500 text-white" onchange="salvarConfigFinanceira()">
                                    <span class="text-sm font-bold text-slate-600 dark:text-slate-300">%</span>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-center">
                                <!-- Coluna da Esquerda: Barra de Saúde -->
                                <div>
                                    <div class="flex justify-between items-end mb-1">
                                        <span class="text-xs font-bold text-slate-500 dark:text-slate-400 uppercase">Saúde Financeira</span>
                                        <span id="label-saude-status" class="text-sm font-bold text-emerald-600">Excelente</span>
                                    </div>
                                    <div class="health-bar-container w-full h-4 bg-slate-100 dark:bg-slate-800 rounded-full">
                                        <div id="bar-saude-fill" class="health-bar-fill h-full bg-emerald-500 rounded-full" style="width: 0%"></div>
                                    </div>
                                    <p id="label-saude-msg" class="text-xs text-slate-400 mt-2">Sua margem de lucro está acima de 30%.</p>
                                </div>

                                <!-- Coluna da Direita: Distribuição (Salário) -->
                                <div class="bg-indigo-50 dark:bg-indigo-900/10 p-4 rounded-xl border border-indigo-100 dark:border-indigo-800/30">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-xs font-bold text-indigo-400 uppercase">Reserva da Empresa</span>
                                        <span id="val-reserva-empresa" class="text-sm font-bold text-indigo-600 dark:text-indigo-400">R$ 0,00</span>
                                    </div>
                                    <div class="border-t border-indigo-200 dark:border-indigo-800 my-2"></div>
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <span class="block text-xs font-bold text-slate-500 dark:text-slate-400 uppercase">Seu Salário (Pró-Labore)</span>
                                            <span class="text-[10px] text-slate-400">Livre para saque</span>
                                        </div>
                                        <span id="val-meu-salario" class="text-2xl font-bold text-emerald-600 dark:text-emerald-400">R$ 0,00</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 px-4 md:px-8 py-6">
                        <div class="lg:col-span-2 bg-slate-900 p-4 rounded-xl border border-slate-800 shadow-sm h-72"><canvas id="grafico-pj"></canvas></div>
                        <div class="bg-slate-900 p-5 rounded-xl shadow-sm border border-slate-800 h-fit"><h3 class="font-bold text-lg mb-4 text-slate-800 dark:text-white">Registrar Movimento</h3>
                        <form onsubmit="adicionarTransacao(event, 'pj')" class="space-y-3">
                            <div class="flex gap-2"><label class="flex-1 cursor-pointer"><input type="radio" name="pj-tipo" value="entrada" checked class="peer hidden"><div class="py-2 text-center rounded-lg border border-slate-700 peer-checked:bg-emerald-100 peer-checked:text-emerald-700 peer-checked:border-emerald-200 dark:peer-checked:bg-emerald-900/30 dark:peer-checked:text-emerald-400 dark:text-slate-300 transition-all font-medium text-sm">Entrada</div></label><label class="flex-1 cursor-pointer"><input type="radio" name="pj-tipo" value="saida" class="peer hidden"><div class="py-2 text-center rounded-lg border border-slate-700 peer-checked:bg-rose-100 peer-checked:text-rose-700 peer-checked:border-rose-200 dark:peer-checked:bg-rose-900/30 dark:peer-checked:text-rose-400 dark:text-slate-300 transition-all font-medium text-sm">Saída</div></label></div>
                            <div class="grid grid-cols-2 gap-3"><input type="text" id="pj-desc" placeholder="Descrição (ex: Conta de Luz)" required class="w-full p-2.5 border border-slate-200 dark:border-slate-700 rounded-lg bg-slate-50 dark:bg-slate-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"><input type="number" id="pj-valor" placeholder="Valor (R$)" step="0.01" required class="w-full p-2.5 border border-slate-200 dark:border-slate-700 rounded-lg bg-slate-50 dark:bg-slate-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"></div>
                            
                            <!-- MODALIDADE -->
                            <div class="grid grid-cols-2 gap-3">
                                <select id="pj-modalidade" onchange="toggleModalidade('pj')" class="w-full p-2.5 border border-slate-200 dark:border-slate-700 rounded-lg bg-slate-50 dark:bg-slate-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm font-medium">
                                    <option value="unico">Único</option>
                                    <option value="recorrente">Recorrente (Mensal)</option>
                                    <option value="parcelado">Parcelado</option>
                                </select>
                                <input type="date" id="pj-data" required class="w-full p-2.5 border border-slate-200 dark:border-slate-700 rounded-lg bg-slate-50 dark:bg-slate-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <!-- PARCELAS / RECORRENCIA (CONDICIONAL) -->
                            <div id="pj-parcelas-container" class="hidden">
                                <label id="pj-parcelas-label" class="block text-[10px] uppercase font-bold text-slate-400 mb-1">Quantidade</label>
                                <input type="number" id="pj-parcelas" placeholder="Qtd" min="1" value="12" class="w-full p-2.5 border border-slate-200 dark:border-slate-700 rounded-lg bg-slate-50 dark:bg-slate-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>

                            <button type="submit" class="w-full bg-slate-800 dark:bg-slate-700 hover:bg-slate-900 dark:hover:bg-slate-600 text-white py-2.5 rounded-lg font-medium transition-colors shadow-lg shadow-slate-900/10">Confirmar</button>
                        </form>
                        </div>
                    </div>
                    <div class="mt-0 px-4 md:px-8 pb-6"><h3 class="font-bold text-slate-700 dark:text-white mb-3">Extrato Recente</h3><div class="bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 overflow-hidden shadow-sm"><div class="max-h-80 overflow-y-auto"><table class="w-full text-left text-sm"><tbody id="lista-transacoes-pj" class="divide-y divide-slate-100 dark:divide-slate-800"></tbody></table></div></div></div>
                </div>

                <!-- VIEW PESSOAL -->
                <div id="view-pessoal" class="view-section hidden fade-in">
                    <div class="sticky top-0 z-40 bg-slate-50 dark:bg-slate-950 px-4 md:px-8 py-6 border-b border-slate-200 dark:border-slate-800 shadow-sm w-full">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="bg-white dark:bg-slate-900 p-4 rounded-xl border-l-4 border-blue-500 shadow-sm"><p class="text-sm text-blue-600 dark:text-blue-400 font-bold">Ganhos Pessoais</p><h3 class="text-2xl font-bold text-blue-800 dark:text-blue-300" id="pf-receita">R$ 0,00</h3></div>
                            <div class="bg-white dark:bg-slate-900 p-4 rounded-xl border-l-4 border-orange-500 shadow-sm"><p class="text-sm text-orange-600 dark:text-orange-400 font-bold">Gastos Pessoais</p><h3 class="text-2xl font-bold text-orange-800 dark:text-orange-300" id="pf-despesa">R$ 0,00</h3></div>
                            <div class="bg-white dark:bg-slate-900 p-4 rounded-xl border-l-4 border-slate-500 shadow-sm"><div class="flex justify-between"><p class="text-sm text-slate-600 dark:text-slate-400 font-bold">Saldo Pessoal</p><button onclick="gerarAnaliseFinanceira('pf')" class="text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded-lg hover:bg-purple-200 flex items-center gap-1 font-bold" title="Gerar Análise com IA"><i class="ph-bold ph-sparkle"></i> Analisar (IA)</button></div><h3 class="text-2xl font-bold text-slate-700 dark:text-white" id="pf-saldo">R$ 0,00</h3></div>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 px-4 md:px-8 py-6">
                        <div class="lg:col-span-2 bg-white dark:bg-slate-900 p-4 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm h-72"><canvas id="grafico-pf"></canvas></div>
                        <div class="bg-white dark:bg-slate-900 p-5 rounded-xl shadow-sm border border-slate-200 dark:border-slate-800 h-fit"><h3 class="font-bold text-lg mb-4 text-slate-800 dark:text-white">Movimentação Pessoal</h3>
                        <form onsubmit="adicionarTransacao(event, 'pf')" class="space-y-3">
                            <div class="flex gap-2"><label class="flex-1 cursor-pointer"><input type="radio" name="pf-tipo" value="entrada" checked class="peer hidden"><div class="py-2 text-center rounded-lg border border-slate-200 dark:border-slate-700 peer-checked:bg-blue-100 peer-checked:text-blue-700 peer-checked:border-blue-200 dark:peer-checked:bg-blue-900/30 dark:peer-checked:text-blue-400 dark:text-slate-300 transition-all font-medium text-sm">Ganho</div></label><label class="flex-1 cursor-pointer"><input type="radio" name="pf-tipo" value="saida" class="peer hidden"><div class="py-2 text-center rounded-lg border border-slate-200 dark:border-slate-700 peer-checked:bg-orange-100 peer-checked:text-orange-700 peer-checked:border-orange-200 dark:peer-checked:bg-orange-900/30 dark:peer-checked:text-orange-400 dark:text-slate-300 transition-all font-medium text-sm">Gasto</div></label></div>
                            <div class="grid grid-cols-2 gap-3"><input type="text" id="pf-desc" placeholder="Descrição (ex: Aluguel)" required class="w-full p-2.5 border border-slate-200 dark:border-slate-700 rounded-lg bg-slate-50 dark:bg-slate-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"><input type="number" id="pf-valor" placeholder="Valor (R$)" step="0.01" required class="w-full p-2.5 border border-slate-200 dark:border-slate-700 rounded-lg bg-slate-50 dark:bg-slate-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"></div>
                            
                            <!-- MODALIDADE -->
                            <div class="grid grid-cols-2 gap-3">
                                <select id="pf-modalidade" onchange="toggleModalidade('pf')" class="w-full p-2.5 border border-slate-200 dark:border-slate-700 rounded-lg bg-slate-50 dark:bg-slate-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm font-medium">
                                    <option value="unico">Único</option>
                                    <option value="recorrente">Recorrente (Mensal)</option>
                                    <option value="parcelado">Parcelado</option>
                                </select>
                                <input type="date" id="pf-data" required class="w-full p-2.5 border border-slate-200 dark:border-slate-700 rounded-lg bg-slate-50 dark:bg-slate-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <!-- PARCELAS / RECORRENCIA -->
                            <div id="pf-parcelas-container" class="hidden">
                                <label id="pf-parcelas-label" class="block text-[10px] uppercase font-bold text-slate-400 mb-1">Quantidade</label>
                                <input type="number" id="pf-parcelas" placeholder="Qtd" min="1" value="12" class="w-full p-2.5 border border-slate-200 dark:border-slate-700 rounded-lg bg-slate-50 dark:bg-slate-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>

                            <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2.5 rounded-lg font-medium transition-colors shadow-lg shadow-blue-600/20">Registrar</button>
                        </form>
                        </div>
                    </div>
                    <div class="mt-0 px-4 md:px-8 pb-6"><h3 class="font-bold text-slate-700 dark:text-white mb-3">Extrato Pessoal</h3><div class="bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 overflow-hidden shadow-sm"><div class="max-h-80 overflow-y-auto"><table class="w-full text-left text-sm"><tbody id="lista-transacoes-pf" class="divide-y divide-slate-100 dark:divide-slate-800"></tbody></table></div></div></div>
                </div>

                <!-- VIEW SCRIPTS -->
                <div id="view-scripts" class="view-section hidden fade-in px-4 md:px-8 py-6">
                    <h3 class="font-bold text-lg text-slate-700 dark:text-white mb-6 flex items-center gap-2"><i class="ph-fill ph-chat-text text-indigo-500"></i> Scripts de Vendas</h3>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-1"><div class="bg-white dark:bg-slate-900 p-5 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-800 sticky top-4"><h4 class="font-bold text-base mb-4 text-slate-800 dark:text-white">Adicionar Novo Script</h4><form onsubmit="adicionarScript(event)" class="space-y-4"><div><label class="block text-xs font-bold text-slate-500 dark:text-slate-400 mb-1 uppercase">Título / Assunto</label><input type="text" id="script-titulo" placeholder="Ex: Apresentação Fria LinkedIn" required class="w-full p-2.5 border border-slate-200 dark:border-slate-700 rounded-lg bg-slate-50 dark:bg-slate-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all"></div><div><label class="block text-xs font-bold text-slate-500 dark:text-slate-400 mb-1 uppercase">Mensagem</label><div class="flex justify-between items-center mb-1"><button type="button" id="btn-gerar-script" onclick="gerarScriptIA()" class="text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded flex items-center gap-1 font-bold hover:bg-purple-200 transition-colors"><i class="ph-bold ph-sparkle"></i> Gerar com IA</button></div><textarea id="script-texto" rows="6" placeholder="Olá {nome}, vi seu perfil e..." required class="w-full p-2.5 border border-slate-200 dark:border-slate-700 rounded-lg bg-slate-50 dark:bg-slate-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all"></textarea></div><button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-3 rounded-xl font-semibold transition-all shadow-lg shadow-indigo-600/20 flex justify-center items-center gap-2"><i class="ph-bold ph-plus-circle"></i> Salvar Script</button></form></div></div>
                        <div class="lg:col-span-2"><div id="lista-scripts" class="space-y-4 grid grid-cols-1 gap-4"></div></div>
                    </div>
                </div>

                <!-- VIEW SEM RETORNO -->
                <div id="view-sem_retorno" class="view-section hidden fade-in px-4 md:px-8 py-6">
                    <div class="flex justify-between items-center mb-4"><h3 class="font-bold text-lg text-slate-700 dark:text-white flex items-center gap-2"><i class="ph-fill ph-clock text-amber-500"></i> Leads Sem Retorno</h3><div class="bg-amber-50 dark:bg-amber-900/20 text-amber-700 dark:text-amber-400 px-3 py-1 rounded-lg text-sm font-bold border border-amber-100 dark:border-amber-800">Total: <span id="total-sem-retorno-tab">R$ 0,00</span></div></div><div id="lista-sem-retorno" class="space-y-3"></div>
                </div>

                <!-- VIEW ATIVOS -->
                <div id="view-ativos" class="view-section hidden fade-in px-4 md:px-8 py-6">
                    <div class="flex justify-between items-center mb-4"><h3 class="font-bold text-lg text-slate-700 dark:text-white flex items-center gap-2"><i class="ph-fill ph-check-circle text-emerald-500"></i> Carteira de Clientes Ativos</h3><div class="bg-emerald-50 dark:bg-emerald-900/20 text-emerald-700 dark:text-emerald-400 px-3 py-1 rounded-lg text-sm font-bold border border-emerald-100 dark:border-emerald-800">Total: <span id="total-ativos-tab">R$ 0,00</span></div></div><div id="lista-ativos-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                </div>

                <!-- VIEW CONTRATOS -->
                <div id="view-contratos" class="view-section hidden fade-in px-4 md:px-8 py-6">
                    <div class="flex justify-between items-center mb-6"><h3 class="font-bold text-lg text-slate-700 dark:text-white flex items-center gap-2"><i class="ph-fill ph-file-text text-purple-500"></i> Gestão de Contratos (Ativos)</h3><div class="text-xs text-slate-500 bg-slate-100 dark:bg-slate-800 px-3 py-1.5 rounded-full flex items-center gap-1"><i class="ph-bold ph-info"></i> Anexe links do Drive/Cloud</div></div><div id="lista-contratos" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                </div>
                
                <!-- VIEW NOTAS FISCAIS -->
                <div id="view-notas" class="view-section hidden fade-in px-4 md:px-8 py-6">
                    <h3 class="font-bold text-lg text-slate-700 dark:text-white mb-6 flex items-center gap-2"><i class="ph-fill ph-receipt text-indigo-500"></i> Gestão de Notas Fiscais</h3>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-1"><div class="bg-white dark:bg-slate-900 p-5 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-800 sticky top-4"><h4 class="font-bold text-base mb-4 text-slate-800 dark:text-white">Registrar Nova Nota</h4><form onsubmit="adicionarNota(event)" class="space-y-4"><div><label class="block text-xs font-bold text-slate-500 dark:text-slate-400 mb-1 uppercase">Número da Nota</label><input type="text" id="nota-numero" placeholder="Ex: 001/2024" required class="w-full p-2.5 border border-slate-200 dark:border-slate-700 rounded-lg bg-slate-50 dark:bg-slate-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all"></div><div><label class="block text-xs font-bold text-slate-500 dark:text-slate-400 mb-1 uppercase">Cliente</label><input type="text" id="nota-cliente" placeholder="Nome do Cliente" required class="w-full p-2.5 border border-slate-200 dark:border-slate-700 rounded-lg bg-slate-50 dark:bg-slate-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all"></div><div class="grid grid-cols-2 gap-3"><div><label class="block text-xs font-bold text-slate-500 dark:text-slate-400 mb-1 uppercase">Valor (R$)</label><input type="number" id="nota-valor" step="0.01" placeholder="0,00" required class="w-full p-2.5 border border-slate-200 dark:border-slate-700 rounded-lg bg-slate-50 dark:bg-slate-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all"></div><div><label class="block text-xs font-bold text-slate-500 dark:text-slate-400 mb-1 uppercase">Data Emissão</label><input type="date" id="nota-data" required class="w-full p-2.5 border border-slate-200 dark:border-slate-700 rounded-lg bg-slate-50 dark:bg-slate-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all"></div></div><div><label class="block text-xs font-bold text-slate-500 dark:text-slate-400 mb-1 uppercase">Link do Arquivo (Drive/Cloud)</label><input type="url" id="nota-link" placeholder="https://..." class="w-full p-2.5 border border-slate-200 dark:border-slate-700 rounded-lg bg-slate-50 dark:bg-slate-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all"></div><button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-3 rounded-xl font-semibold transition-all shadow-lg shadow-indigo-600/20 flex justify-center items-center gap-2"><i class="ph-bold ph-plus-circle"></i> Salvar Nota</button></form></div></div>
                        <div class="lg:col-span-2"><div class="flex justify-between items-center mb-2"><h4 class="font-bold text-base text-slate-700 dark:text-slate-300">Histórico de Notas</h4><div class="bg-indigo-50 dark:bg-indigo-900/20 text-indigo-700 dark:text-indigo-400 px-3 py-1 rounded-lg text-sm font-bold border border-indigo-100 dark:border-indigo-800">Total Emitido: <span id="total-notas">R$ 0,00</span></div></div><div id="lista-notas" class="space-y-3"></div></div>
                    </div>
                </div>

                <!-- VIEW INATIVOS -->
                <div id="view-inativos" class="view-section hidden fade-in px-4 md:px-8 py-6"><div class="flex justify-between items-center mb-4"><h3 class="font-bold text-lg text-slate-700 dark:text-white flex items-center gap-2"><i class="ph-fill ph-user-minus text-slate-500"></i> Clientes Inativos ou Perdidos</h3><div class="bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 px-3 py-1 rounded-lg text-sm font-bold border border-slate-200 dark:border-slate-700">Total: <span id="total-inativos-tab">R$ 0,00</span></div></div><div id="lista-inativos" class="space-y-3"></div></div>

                <!-- VIEW PERFIL -->
                <div id="view-perfil" class="view-section hidden fade-in px-4 md:px-8 py-6">
                    <h3 class="font-bold text-lg text-slate-700 dark:text-white mb-6 flex items-center gap-2"><i class="ph-fill ph-user-gear text-blue-600"></i> Configurar Perfil da Empresa</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div class="md:col-span-1">
                            <div class="bg-white dark:bg-slate-900 p-6 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 text-center">
                                <div class="relative w-32 h-32 mx-auto mb-4 rounded-full bg-slate-100 dark:bg-slate-800 border-4 border-white dark:border-slate-600 shadow-md overflow-hidden flex items-center justify-center group"><img id="profile-preview" src="" alt="" class="w-full h-full object-cover hidden"><i id="profile-placeholder" class="ph-fill ph-user text-4xl text-slate-300"></i><label for="profile-upload" class="absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer text-white text-xs font-bold uppercase tracking-widest">Alterar</label></div>
                                <input type="file" id="profile-upload" accept="image/*" class="hidden" onchange="uploadProfileImage(this)">
                                <h4 class="font-bold text-slate-800 dark:text-white" id="display-company">Sua Empresa</h4><p class="text-sm text-slate-500 dark:text-slate-400" id="display-name">Seu Nome</p><p class="mt-4 text-xs text-slate-400">A imagem ficará salva apenas neste navegador.</p>
                            </div>
                        </div>
                        <div class="md:col-span-2">
                            <div class="bg-white dark:bg-slate-900 p-6 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700">
                                <form onsubmit="salvarPerfil(event)" class="space-y-4">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label class="block text-xs font-bold text-slate-500 dark:text-slate-400 mb-1 uppercase">Nome da Empresa</label><input type="text" id="prof-company" class="w-full p-2.5 border border-slate-200 dark:border-slate-700 rounded-lg bg-slate-50 dark:bg-slate-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"></div><div><label class="block text-xs font-bold text-slate-500 dark:text-slate-400 mb-1 uppercase">Seu Nome</label><input type="text" id="prof-name" class="w-full p-2.5 border border-slate-200 dark:border-slate-700 rounded-lg bg-slate-50 dark:bg-slate-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"></div></div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label class="block text-xs font-bold text-slate-500 dark:text-slate-400 mb-1 uppercase">E-mail</label><input type="email" id="prof-email" class="w-full p-2.5 border border-slate-200 dark:border-slate-700 rounded-lg bg-slate-50 dark:bg-slate-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"></div><div><label class="block text-xs font-bold text-slate-500 dark:text-slate-400 mb-1 uppercase">Telefone</label><input type="text" id="prof-phone" class="w-full p-2.5 border border-slate-200 dark:border-slate-700 rounded-lg bg-slate-50 dark:bg-slate-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"></div></div>
                                    <div><label class="block text-xs font-bold text-slate-500 dark:text-slate-400 mb-1 uppercase">Cargo / Função</label><input type="text" id="prof-role" class="w-full p-2.5 border border-slate-200 dark:border-slate-700 rounded-lg bg-slate-50 dark:bg-slate-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"></div>
                                    <div class="pt-4 border-t border-slate-100 dark:border-slate-800 flex justify-end"><button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2.5 rounded-lg font-bold transition-colors shadow-lg shadow-blue-600/20">Salvar Alterações</button></div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

            </main>

            <!-- RODAPÉ FIXO -->
            <footer class="text-center py-4 px-4 text-slate-400 border-t border-slate-800 bg-slate-900 shrink-0 z-30 text-[10px]">
                <div class="flex flex-col md:flex-row items-center justify-center gap-3 md:gap-6">
                    <p>&copy; <script>document.write(new Date().getFullYear())</script> Gestor Pro.</p>
                    <p class="uppercase tracking-wide font-bold opacity-60">🚫 Proibido o repasse/revenda</p>
                </div>
            </footer>
        </div>
    </div>

    <!-- MODAL DE CONFIGURAÇÃO (API KEY) -->
    <div id="modal-config" class="hidden fixed inset-0 z-[200] bg-slate-950/90 flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-slate-900 p-6 rounded-2xl shadow-2xl border border-slate-700 w-full max-w-md">
            <h3 class="text-xl font-bold text-white mb-4">Configurações</h3>
            <label class="block text-xs font-bold text-slate-400 mb-2 uppercase">Gemini API Key (IA)</label>
            <input type="password" id="input-api-key" placeholder="Cole sua chave aqui..." class="w-full p-3 bg-slate-950 border border-slate-700 rounded-lg text-white mb-4 focus:outline-none focus:border-blue-500">
            <div class="flex justify-end gap-2">
                <button onclick="document.getElementById('modal-config').classList.add('hidden')" class="px-4 py-2 text-slate-400 hover:text-white">Cancelar</button>
                <button onclick="salvarConfig()" class="px-6 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg font-bold">Salvar</button>
            </div>
        </div>
    </div>

    <!-- MODAL DE IA -->
    <div id="modal-ai" class="hidden fixed inset-0 z-[200] bg-slate-950/90 flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-slate-900 p-6 rounded-2xl shadow-2xl border border-slate-700 w-full max-w-2xl flex flex-col max-h-[80vh]">
            <div class="flex justify-between items-center mb-4"><h3 class="text-xl font-bold text-white flex items-center gap-2"><i class="ph-fill ph-sparkle text-purple-500"></i> Assistente IA</h3><button onclick="fecharAI()" class="text-slate-400 hover:text-white"><i class="ph-bold ph-x text-xl"></i></button></div>
            <div id="ai-loading" class="hidden flex flex-col items-center justify-center py-12"><i class="ph-bold ph-spinner animate-spin text-4xl text-blue-500 mb-3"></i><p class="text-slate-500 animate-pulse">Gerando resposta...</p></div>
            <div id="ai-content" class="prose prose-invert max-w-none overflow-y-auto text-sm text-slate-300 bg-slate-950 p-4 rounded-xl border border-slate-800 flex-1"></div>
            <div class="mt-4 flex justify-end gap-2"><button onclick="copiarTextoAI()" class="px-4 py-2 bg-slate-800 text-white rounded-lg font-bold flex items-center gap-2"><i class="ph-bold ph-copy"></i> Copiar</button><button onclick="fecharAI()" class="px-4 py-2 bg-blue-600 text-white rounded-lg font-bold">Fechar</button></div>
        </div>
    </div>
    
    <!-- MODAL DE EDIÇÃO -->
    <div id="custom-input-box-container"></div>

    <!-- FIREBASE MODULE TYPE -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, where, onSnapshot, doc, updateDoc, deleteDoc, getDoc, setDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // CONFIGURAÇÃO DO FIREBASE (SUAS CHAVES REAIS)
        const firebaseConfig = {
            apiKey: "AIzaSyDSdQylysTQm4JyBGS6GPGO6MhI0rh6rMo",
            authDomain: "gestorpro-saas.firebaseapp.com",
            projectId: "gestorpro-saas",
            storageBucket: "gestorpro-saas.firebasestorage.app",
            messagingSenderId: "653082894438",
            appId: "1:653082894438:web:4333cab368003c27d34da7"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        let currentUser = null;
        let cachePJ = [];
        let unsubLeads, unsubPJ, unsubPF, unsubScripts, unsubNotas;

        // Auth Listeners
        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                const emailDisplay = document.getElementById('user-email-display');
                if (emailDisplay) emailDisplay.innerText = user.email;
                
                document.getElementById('login-overlay').classList.add('opacity-0', 'pointer-events-none');
                document.getElementById('app-content').classList.remove('opacity-0', 'pointer-events-none');
                document.getElementById('app-content').classList.remove('blur-content');
                iniciarListeners(user.uid); 
                initBackgroundAnimation(); 
            } else {
                currentUser = null;
                document.getElementById('login-overlay').classList.remove('opacity-0', 'pointer-events-none');
                document.getElementById('app-content').classList.add('opacity-0', 'pointer-events-none');
                document.getElementById('app-content').classList.add('blur-content');
                initBackgroundAnimation();
            }
        });

        document.getElementById('login-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const btn = document.getElementById('login-btn');
            const originalText = btn.innerHTML;
            const msg = document.getElementById('login-msg');
            btn.innerHTML = '<i class="ph-bold ph-spinner animate-spin"></i>';
            msg.classList.add('hidden');
            
            signInWithEmailAndPassword(auth, document.getElementById('login-email').value, document.getElementById('login-pass').value)
            .catch((error) => {
                // Auto-create logic: Se o user não existir, cria e loga.
                if(error.code === 'auth/user-not-found' || error.code === 'auth/invalid-credential') {
                     if(confirm("Usuário não encontrado. Deseja criar esta conta agora?")) {
                         createUserWithEmailAndPassword(auth, document.getElementById('login-email').value, document.getElementById('login-pass').value)
                         .then(() => alert("Conta criada! Entrando..."))
                         .catch(err => {
                             msg.innerText = "Erro ao criar: " + err.message;
                             msg.classList.remove('hidden');
                             btn.innerHTML = originalText;
                         });
                     } else {
                        msg.innerText = "Erro: Credenciais inválidas.";
                        msg.classList.remove('hidden');
                        btn.innerHTML = originalText;
                     }
                } else {
                    msg.innerText = "Erro: " + error.message;
                    msg.classList.remove('hidden');
                    btn.innerHTML = originalText;
                }
            });
        });

        window.logout = () => {
            if(unsubLeads) unsubLeads();
            if(unsubPJ) unsubPJ();
            if(unsubPF) unsubPF();
            if(unsubScripts) unsubScripts();
            if(unsubNotas) unsubNotas();
            signOut(auth);
        };

        // Firestore Listeners (Recupera dados em tempo real)
        function iniciarListeners(uid) {
            // Leads
            unsubLeads = onSnapshot(query(collection(db, "leads"), where("userId", "==", uid)), (snap) => {
                const leads = []; snap.forEach(d => leads.push({id:d.id, ...d.data()})); renderLeads(leads);
            });
            // Financeiro PJ
            unsubPJ = onSnapshot(query(collection(db, "financeiro_pj"), where("userId", "==", uid)), (snap) => {
                const t = []; snap.forEach(d => t.push({id:d.id, ...d.data()})); cachePJ = t; renderFinanceiro(t, 'pj'); calcularSaudeFinanceira();
            });
            // Financeiro PF
            unsubPF = onSnapshot(query(collection(db, "financeiro_pf"), where("userId", "==", uid)), (snap) => {
                const t = []; snap.forEach(d => t.push({id:d.id, ...d.data()})); renderFinanceiro(t, 'pf');
            });
            // Scripts
            unsubScripts = onSnapshot(query(collection(db, "scripts"), where("userId", "==", uid)), (snap) => {
                const s = []; snap.forEach(d => s.push({id:d.id, ...d.data()})); renderScripts(s);
            });
            // Notas
            unsubNotas = onSnapshot(query(collection(db, "notas"), where("userId", "==", uid)), (snap) => {
                const n = []; snap.forEach(d => n.push({id:d.id, ...d.data()})); renderNotas(n);
            });
            // Perfil
            getDoc(doc(db, "profiles", uid)).then(docSnap => {
                if(docSnap.exists()) {
                    const data = docSnap.data();
                    if(document.getElementById('prof-company')) document.getElementById('prof-company').value = data.company || '';
                    if(document.getElementById('prof-name')) document.getElementById('prof-name').value = data.name || '';
                    if(document.getElementById('prof-email')) document.getElementById('prof-email').value = data.email || '';
                    if(document.getElementById('prof-role')) document.getElementById('prof-role').value = data.role || '';
                    if(data.image) atualizarAvatar(data.image);
                    if(document.getElementById('display-company')) document.getElementById('display-company').innerText = data.company || 'Sua Empresa';
                    if(document.getElementById('display-name')) document.getElementById('display-name').innerText = data.name || 'Seu Nome';
                    if(document.getElementById('header-name')) document.getElementById('header-name').innerText = data.company || 'Gestor Pro';
                }
            });
        }

        // Funções de Dados (CRUD)
        window.adicionarLead = async (e) => {
            e.preventDefault();
            await addDoc(collection(db, "leads"), { userId: currentUser.uid, nome: document.getElementById('lead-nome').value, empresa: document.getElementById('lead-empresa').value, doc: document.getElementById('lead-doc').value, social: document.getElementById('lead-social').value, valor: parseFloat(document.getElementById('lead-valor').value)||0, status: 'negociacao', createdAt: new Date() });
            e.target.reset(); mostrarToast('Lead salvo!');
        };

        window.alterarStatusLead = async (id, novoStatus, valor, nome) => {
            await updateDoc(doc(db, "leads", id), { status: novoStatus });
            if(novoStatus === 'ganho') await addDoc(collection(db, "financeiro_pj"), { userId: currentUser.uid, op: 'entrada', desc: `Fechamento: ${nome}`, valor: valor, data: new Date().toISOString().split('T')[0], leadId: id });
            
            // Remove do financeiro se deixar de ser ganho
            if(novoStatus !== 'ganho') {
                 const q = query(collection(db, "financeiro_pj"), where("leadId", "==", id));
                 const snap = await getDocs(q);
                 snap.forEach(d => deleteDoc(d.ref));
            }
        };

        window.adicionarTransacao = async (e, tipo) => {
            e.preventDefault();
            const op = document.querySelector(`input[name="${tipo}-tipo"]:checked`).value;
            const desc = document.getElementById(`${tipo}-desc`).value;
            const valor = parseFloat(document.getElementById(`${tipo}-valor`).value);
            const data = document.getElementById(`${tipo}-data`).value;
            const modalidade = document.getElementById(`${tipo}-modalidade`).value;
            const parcelas = parseInt(document.getElementById(`${tipo}-parcelas`)?.value) || 1;
            const collectionName = tipo === 'pj' ? 'financeiro_pj' : 'financeiro_pf';
            
            let loop = modalidade === 'unico' ? 1 : (modalidade === 'parcelado' ? parcelas : (modalidade === 'recorrente' ? 12 : 1));
            let dateObj = new Date(data);

            for(let i=0; i<loop; i++) {
                let curDesc = desc; if(modalidade === 'parcelado') curDesc += ` (${i+1}/${loop})`;
                let newDate = new Date(dateObj); newDate.setMonth(newDate.getMonth() + i);
                await addDoc(collection(db, collectionName), { userId: currentUser.uid, op, desc: curDesc, valor, data: newDate.toISOString().split('T')[0], modalidade, createdAt: new Date() });
            }
            e.target.reset(); mostrarToast('Lançamento salvo!');
        };

        window.adicionarScript = async (e) => {
            e.preventDefault();
            await addDoc(collection(db, "scripts"), { userId: currentUser.uid, titulo: document.getElementById('script-titulo').value, texto: document.getElementById('script-texto').value });
            e.target.reset(); mostrarToast('Script salvo!');
        };
        
        window.adicionarNota = async (e) => {
            e.preventDefault();
            await addDoc(collection(db, "notas"), { 
                userId: currentUser.uid, 
                numero: document.getElementById('nota-numero').value,
                cliente: document.getElementById('nota-cliente').value,
                valor: parseFloat(document.getElementById('nota-valor').value)||0,
                data: document.getElementById('nota-data').value,
                link: document.getElementById('nota-link').value,
                status: 'emitida'
            });
            e.target.reset(); mostrarToast('Nota salva!');
        };

        window.excluirItem = async (col, id) => { if(confirm('Apagar?')) await deleteDoc(doc(db, col, id)); };

        window.salvarPerfil = async (e) => {
            e.preventDefault();
            await setDoc(doc(db, "profiles", currentUser.uid), {
                company: document.getElementById('prof-company').value,
                name: document.getElementById('prof-name').value,
                email: document.getElementById('prof-email').value,
                phone: document.getElementById('prof-phone').value,
                role: document.getElementById('prof-role').value
            }, { merge: true });
            mostrarToast('Perfil salvo!');
        };
        
        // Upload de Imagem (Simulado Local -> Base64 para Firestore se for pequena, ou Alert se for grande)
        // Nota: Firestore tem limite de 1MB por doc. Idealmente usaria Storage, mas para simplificar mantemos no doc ou local.
        window.uploadProfileImage = (input) => {
            const file = input.files[0];
            if(file) {
                const reader = new FileReader();
                reader.onload = async (e) => {
                    const base64 = e.target.result;
                    if(base64.length > 1000000) return alert("Imagem muito grande. Use uma menor.");
                    await setDoc(doc(db, "profiles", currentUser.uid), { image: base64 }, { merge: true });
                    atualizarAvatar(base64);
                };
                reader.readAsDataURL(file);
            }
        };

        function atualizarAvatar(src) {
            const headerAvatar = document.getElementById('header-avatar');
            if(headerAvatar) headerAvatar.innerHTML = `<img src="${src}" class="w-full h-full object-cover">`;
            const preview = document.getElementById('profile-preview');
            if(preview) { preview.src = src; preview.classList.remove('hidden'); }
            const placeholder = document.getElementById('profile-placeholder');
            if(placeholder) placeholder.classList.add('hidden');
        }

        window.toggleModalidade = (tipo) => {
            const val = document.getElementById(`${tipo}-modalidade`).value;
            const container = document.getElementById(`${tipo}-parcelas-container`);
            if(val === 'unico') container.classList.add('hidden');
            else container.classList.remove('hidden');
        };
        
        // Edição de Valor Lead
        window.editarValorLead = (id) => {
             // Recupera do HTML atual (não temos DB local sync completo, pegamos do DOM ou cache se necessário, mas idealmente do Firestore)
             // Como não temos cache global de leads aqui, vamos buscar o doc
             getDoc(doc(db, "leads", id)).then(snap => {
                 if(snap.exists()) {
                     const l = snap.data();
                     const box = document.createElement('div');
                     box.id = 'custom-input-box';
                     box.className = 'fixed inset-0 z-[300] bg-slate-900/90 flex items-center justify-center p-4 backdrop-blur-sm';
                     box.innerHTML = `
                        <div class="bg-white dark:bg-slate-900 p-6 rounded-2xl shadow-2xl max-w-md w-full border border-slate-200 dark:border-slate-700 animate-in zoom-in-95 duration-200">
                            <h3 class="text-lg font-bold text-slate-800 dark:text-white mb-4">Editar Lead</h3>
                            <div class="space-y-3">
                                <input type="text" id="edit-nome" value="${l.nome}" class="w-full p-2.5 border rounded-lg bg-slate-50 dark:bg-slate-800 dark:text-white">
                                <input type="number" id="edit-valor" value="${l.valor}" class="w-full p-2.5 border rounded-lg bg-slate-50 dark:bg-slate-800 dark:text-white">
                            </div>
                            <div class="flex gap-2 mt-6">
                                <button onclick="document.getElementById('custom-input-box').remove()" class="flex-1 py-2.5 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 rounded-xl">Cancelar</button>
                                <button onclick="confirmarEdicaoValor('${id}')" class="flex-1 py-2.5 bg-blue-600 text-white rounded-xl">Salvar</button>
                            </div>
                        </div>`;
                     document.body.appendChild(box);
                 }
             });
        };
        
        window.confirmarEdicaoValor = async (id) => {
            const nome = document.getElementById('edit-nome').value;
            const valor = parseFloat(document.getElementById('edit-valor').value);
            await updateDoc(doc(db, "leads", id), { nome, valor });
            
            // Atualiza financeiro se existir vinculo
            const q = query(collection(db, "financeiro_pj"), where("leadId", "==", id));
            const snap = await getDocs(q);
            snap.forEach(d => updateDoc(d.ref, { valor, desc: `Fechamento: ${nome}` }));
            
            document.getElementById('custom-input-box').remove();
            mostrarToast('Atualizado!');
        };

        // Renderização (Listas e Visual)
        function renderLeads(leads) {
            const list = document.getElementById('lista-leads'); list.innerHTML = '';
            const listSem = document.getElementById('lista-sem-retorno'); if(listSem) listSem.innerHTML = '';
            const listAti = document.getElementById('lista-ativos-grid'); if(listAti) listAti.innerHTML = '';
            const listCon = document.getElementById('lista-contratos'); if(listCon) listCon.innerHTML = '';
            const listIna = document.getElementById('lista-inativos'); if(listIna) listIna.innerHTML = '';

            let totalPot = 0, totalAti = 0;
            leads.forEach(l => {
                if(l.status === 'negociacao') totalPot += l.valor;
                if(l.status === 'ganho') totalAti += l.valor;
                
                const card = `<div class="bg-slate-900 p-4 rounded-xl border border-slate-800 flex justify-between items-center shadow-sm mb-2"><div><div class="font-bold text-white">${l.nome}</div><div class="text-sm text-slate-400">${l.empresa} - ${formatMoney(l.valor)}</div></div><div class="flex gap-2"><button onclick="alterarStatusLead('${l.id}','ganho',${l.valor},'${l.nome}')" class="text-emerald-500 p-2"><i class="ph-bold ph-check"></i></button><button onclick="alterarStatusLead('${l.id}','sem_retorno',0,'')" class="text-amber-500 p-2"><i class="ph-bold ph-clock"></i></button><button onclick="editarValorLead('${l.id}')" class="text-blue-500 p-2"><i class="ph-bold ph-pencil-simple"></i></button><button onclick="excluirItem('leads','${l.id}')" class="text-slate-500 p-2"><i class="ph-bold ph-trash"></i></button></div></div>`;
                
                if(l.status === 'negociacao') list.innerHTML += card;
                if(l.status === 'sem_retorno' && listSem) listSem.innerHTML += card.replace('text-amber-500','hidden'); // Hide unneeded buttons
                if(l.status === 'ganho' && listAti) listAti.innerHTML += `<div class="bg-slate-900 p-5 rounded-xl border border-emerald-900/30"><div class="font-bold text-white">${l.nome}</div><div class="text-emerald-400 font-bold">${formatMoney(l.valor)}</div><button onclick="alterarStatusLead('${l.id}','inativo',0,'')" class="text-xs mt-2 bg-slate-800 px-2 py-1 rounded text-slate-400 hover:text-white">Desativar</button></div>`;
                if(l.status === 'ganho' && listCon) listCon.innerHTML += `<div class="bg-slate-900 p-5 rounded-xl border border-slate-800"><div>${l.nome}</div><div class="text-xs text-slate-500">Contrato Ativo</div><div class="mt-2 text-emerald-400 font-bold">${formatMoney(l.valor)}</div></div>`;
                if((l.status === 'perdido' || l.status === 'inativo') && listIna) listIna.innerHTML += `<div class="bg-slate-900 p-4 rounded border border-slate-800 opacity-50 flex justify-between"><div>${l.nome}</div><button onclick="excluirItem('leads','${l.id}')"><i class="ph-bold ph-trash"></i></button></div>`;
            });
            document.getElementById('crm-potencial').innerText = formatMoney(totalPot);
            document.getElementById('crm-ativos').innerText = formatMoney(totalAti);
        }

        function renderFinanceiro(dados, tipo) {
            const ent = dados.filter(t=>t.op==='entrada').reduce((a,b)=>a+b.valor,0);
            const sai = dados.filter(t=>t.op==='saida').reduce((a,b)=>a+b.valor,0);
            document.getElementById(`${tipo}-receita`).innerText = formatMoney(ent);
            document.getElementById(`${tipo}-despesa`).innerText = formatMoney(sai);
            document.getElementById(`${tipo}-saldo`).innerText = formatMoney(ent-sai);
            
            const list = document.getElementById(`lista-transacoes-${tipo}`); list.innerHTML = '';
            dados.sort((a,b)=>new Date(b.data)-new Date(a.data)).forEach(t => {
                list.innerHTML += `<tr class="border-b border-slate-800"><td class="p-3 text-slate-300">${t.desc}<div class="text-xs text-slate-500">${new Date(t.data).toLocaleDateString()}</div></td><td class="p-3 text-right ${t.op==='entrada'?'text-emerald-400':'text-rose-400'}">${formatMoney(t.valor)}</td><td class="p-3 text-right"><button onclick="excluirItem('${tipo==='pj'?'financeiro_pj':'financeiro_pf'}','${t.id}')"><i class="ph-bold ph-trash"></i></button></td></tr>`;
            });
            atualizarGrafico(tipo, ent, sai);
        }

        function renderScripts(scripts) {
            const div = document.getElementById('lista-scripts'); div.innerHTML = '';
            scripts.forEach(s => {
                div.innerHTML += `<div class="bg-slate-900 p-4 rounded border border-slate-800 mb-2"><h4 class="font-bold text-white">${s.titulo}</h4><p class="text-sm text-slate-400 mt-2 whitespace-pre-wrap">${s.texto}</p><button onclick="excluirItem('scripts','${s.id}')" class="mt-2 text-rose-500 text-xs">Excluir</button></div>`;
            });
        }
        
        function renderNotas(notas) {
            const div = document.getElementById('lista-notas'); div.innerHTML = '';
            notas.forEach(n => {
                div.innerHTML += `<div class="bg-slate-900 p-4 rounded border border-slate-800 mb-2 flex justify-between"><div><div class="font-bold text-white">#${n.numero} - ${n.cliente}</div><div class="text-xs text-slate-400">${formatMoney(n.valor)}</div></div><button onclick="excluirItem('notas','${n.id}')" class="text-rose-500"><i class="ph-bold ph-trash"></i></button></div>`;
            });
        }

        let chartInstancePJ = null;
        let chartInstancePF = null;
        function atualizarGrafico(tipo, entradas, saidas) {
            const ctx = document.getElementById(`grafico-${tipo}`)?.getContext('2d');
            if(!ctx) return;
            const config = {
                type: 'bar',
                data: {
                    labels: ['Entradas', 'Saídas'],
                    datasets: [{
                        data: [entradas, saidas],
                        backgroundColor: [tipo==='pj'?'#10b981':'#3b82f6', tipo==='pj'?'#f43f5e':'#f97316'],
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true, grid: { color: '#334155' } }, x: { grid: { display: false } } }
                }
            };
            if(tipo === 'pj') { if(chartInstancePJ) chartInstancePJ.destroy(); chartInstancePJ = new Chart(ctx, config); }
            else { if(chartInstancePF) chartInstancePF.destroy(); chartInstancePF = new Chart(ctx, config); }
        }

        window.calcularSaudeFinanceira = () => {
            const ent = cachePJ.filter(t=>t.op==='entrada').reduce((a,b)=>a+b.valor,0);
            const sai = cachePJ.filter(t=>t.op==='saida').reduce((a,b)=>a+b.valor,0);
            const lucro = ent - sai;
            const perc = parseInt(document.getElementById('input-reserva').value)||20;
            const status = document.getElementById('label-saude-status');
            const bar = document.getElementById('bar-saude-fill');
            
            if(lucro <= 0) {
                status.innerText = "Prejuízo"; status.className = "text-rose-500 font-bold";
                bar.className = "h-full bg-rose-500 w-full";
                document.getElementById('val-meu-salario').innerText = "R$ 0,00";
            } else {
                status.innerText = "Positivo"; status.className = "text-emerald-400 font-bold";
                bar.className = "h-full bg-emerald-500";
                bar.style.width = "100%";
                document.getElementById('val-meu-salario').innerText = formatMoney(lucro * ((100-perc)/100));
            }
        };

        const formatMoney = (val) => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(val);
        function mostrarToast(msg) { const t = document.getElementById('toast'); t.innerText = msg; t.classList.remove('hidden', 'translate-y-10', 'opacity-0'); setTimeout(() => { t.classList.add('translate-y-10', 'opacity-0'); setTimeout(() => t.classList.add('hidden'), 300); }, 3000); }
        window.mudarAba = (aba) => { document.querySelectorAll('.view-section').forEach(e => e.classList.add('hidden')); document.getElementById(`view-${aba}`).classList.remove('hidden'); };
        window.toggleSidebar = () => { document.getElementById('sidebar').classList.toggle('sidebar-closed'); };
        
        function initBackgroundAnimation() {
            const cvs = document.getElementById('login-bg-canvas'); if(!cvs) return; const ctx = cvs.getContext('2d');
            let w, h, p = []; const resize = () => { w = cvs.width = window.innerWidth; h = cvs.height = window.innerHeight; };
            window.addEventListener('resize', resize); resize();
            for(let i=0;i<60;i++)p.push({x:Math.random()*w,y:Math.random()*h,vx:(Math.random()-.5),vy:(Math.random()-.5)});
            function anim() { ctx.clearRect(0,0,w,h); ctx.fillStyle='rgba(100,150,255,0.4)'; p.forEach(pt=>{pt.x+=pt.vx;pt.y+=pt.vy;if(pt.x<0||pt.x>w)pt.vx*=-1;if(pt.y<0||pt.y>h)pt.vy*=-1;ctx.beginPath();ctx.arc(pt.x,pt.y,2,0,Math.PI*2);ctx.fill()}); requestAnimationFrame(anim); }
            anim();
        }

        // --- FUNÇÕES DE AUXÍLIO PARA UI (Configuração e IA) ---
        window.abrirConfig = () => document.getElementById('modal-config').classList.remove('hidden');
        window.salvarConfig = () => { localStorage.setItem('gemini_api_key', document.getElementById('input-api-key').value); document.getElementById('modal-config').classList.add('hidden'); mostrarToast('Configuração salva!'); }
        
        window.gerarScriptIA = () => {
            const titulo = document.getElementById('script-titulo').value;
            if(!titulo) return mostrarToast("Digite um título.");
            const key = localStorage.getItem('gemini_api_key');
            if(!key) { abrirConfig(); return mostrarToast("Configure a API Key."); }
            
            document.getElementById('script-texto').value = "Gerando...";
            fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${key}`, {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({contents: [{parts: [{text: `Crie um script de venda curto e persuasivo para: ${titulo}`}]}]})
            }).then(r=>r.json()).then(d=>document.getElementById('script-texto').value=d.candidates[0].content.parts[0].text);
        };
        
        window.copiarTextoAI = () => { navigator.clipboard.writeText(document.getElementById('ai-content').innerText); mostrarToast('Copiado!'); }
        window.fecharAI = () => document.getElementById('modal-ai').classList.add('hidden');
        window.togglePrivacy = () => { showValues = !showValues; renderizar(); };
    </script>
</body>
</html>
